<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ | å°è®©ã®ç³–æœå±‹</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/blog/favicon.ico">
    <script charset="utf-8" async="async" src="/blog/js/jquery.min.js"></script>
    <script charset="utf-8" async="async" src="/blog/js/global.js"></script>
    <script charset="utf-8" async="async" src="/blog/js/fingerprint2.min.js"></script>
    <script>
              var _hmt = _hmt || [];
              (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?0b31b4c146bf7126aed5009e1a4a11c8";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
              })();
            </script>
    <meta name="description" content="åŒ…å«: Java åŸºç¡€, Javaè®¾è®¡æ¨¡å¼, æ•°æ®ç»“æ„ä¸ç®—æ³•, æºç åˆ†æ...">
    <meta property="article:modified_time" content="2022-11-12T04:44:27.000Z">
    <meta property="og:title" content="Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ">
    <meta property="og:type" content="article">
    <meta property="og:url" content="/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html">
    <meta name="twitter:title" content="Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ">
    <meta name="twitter:url" content="/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="spring, æºç ">
    <meta property="article:tag" content="spring">
    <meta name="robots" content="all">
    <meta name="author" content="å°è®©">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="keywords" content="å°è®©ã®ç³–æœå±‹, æ•°æ®ç»“æ„ä¸ç®—æ³•, è®¾è®¡æ¨¡å¼, æºç åˆ†æ, JavaåŸºç¡€, å…«è‚¡æ–‡">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <link rel="preload" href="/blog/assets/css/0.styles.81cff77c.css" as="style"><link rel="preload" href="/blog/assets/css/styles.css?v=1668302853734" as="style"><link rel="preload" href="/blog/assets/js/cg-styles.js?v=1668302853734" as="script"><link rel="preload" href="/blog/assets/js/cg-app.js?v=1668302853734" as="script"><link rel="preload" href="/blog/assets/js/cg-3.js?v=1668302853734" as="script"><link rel="preload" href="/blog/assets/js/cg-4.js?v=1668302853734" as="script"><link rel="preload" href="/blog/assets/js/cg-24.js?v=1668302853734" as="script">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.81cff77c.css"><link rel="stylesheet" href="/blog/assets/css/styles.css?v=1668302853734">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">å°è®©ã®ç³–æœå±‹</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/md/other/guide-to-reading.html" class="nav-link">
  å¯¼è¯»
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•" class="dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/æ•°æ®ç»“æ„ä¸ç®—æ³•/æ•°æ®ç»“æ„/" class="nav-link">
  æ•°æ®ç»“æ„
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/æ•°æ®ç»“æ„ä¸ç®—æ³•/ç®—æ³•/æ’åºç®—æ³•/å†’æ³¡æ’åº.html" class="nav-link">
  ç®—æ³•ä¸»é¢˜
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/java/interview/HashMap.html" class="nav-link">
  é¢è¯•å®å…¸
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/java/core/" class="nav-link">
  åŸºç¡€æŠ€æœ¯
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Springå…¨å®¶æ¡¶" class="dropdown-title"><span class="title">Springå…¨å®¶æ¡¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/springå…¨å®¶æ¡¶/spring/åŸºç¡€/IOC/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/springå…¨å®¶æ¡¶/springmvc/åŸºç¡€/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/springå…¨å®¶æ¡¶/spring-security/åŸºç¡€/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/md/other/guide-to-reading.html" class="nav-link">
  å¯¼è¯»
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç®—æ³•" class="dropdown-title"><span class="title">ç®—æ³•</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/æ•°æ®ç»“æ„ä¸ç®—æ³•/æ•°æ®ç»“æ„/" class="nav-link">
  æ•°æ®ç»“æ„
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/æ•°æ®ç»“æ„ä¸ç®—æ³•/ç®—æ³•/æ’åºç®—æ³•/å†’æ³¡æ’åº.html" class="nav-link">
  ç®—æ³•ä¸»é¢˜
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/java/interview/HashMap.html" class="nav-link">
  é¢è¯•å®å…¸
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/java/core/" class="nav-link">
  åŸºç¡€æŠ€æœ¯
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Springå…¨å®¶æ¡¶" class="dropdown-title"><span class="title">Springå…¨å®¶æ¡¶</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/md/springå…¨å®¶æ¡¶/spring/åŸºç¡€/IOC/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/springå…¨å®¶æ¡¶/springmvc/åŸºç¡€/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/blog/md/springå…¨å®¶æ¡¶/spring-security/åŸºç¡€/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>SpringåŸºç¡€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/åŸºç¡€/IOC.html" class="sidebar-link">Spring-IOC</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/åŸºç¡€/AOP.html" class="sidebar-link">Spring-AOP</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/åŸºç¡€/JDBC.html" class="sidebar-link">Spring-JDBC</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/åŸºç¡€/äº‹åŠ¡.html" class="sidebar-link">Springäº‹åŠ¡</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/åŸºç¡€/Springæ³¨è§£é©±åŠ¨å¼€å‘.html" class="sidebar-link">Springæ³¨è§£é©±åŠ¨å¼€å‘</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Springæºç åˆ†æ</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Springæºç ç¯å¢ƒæ­å»º.html" class="sidebar-link">Springæºç ç¯å¢ƒæ­å»º</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Springæ³¨å†ŒBeançš„å‡ ç§æ–¹å¼.html" class="sidebar-link">Springæ³¨å†ŒBeançš„å‡ ç§æ–¹å¼</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ.html" class="active sidebar-link">Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Spring-ConfigurationClassPostProcessoråç½®å¤„ç†å™¨è¯¦è§£.html" class="sidebar-link">Spring-ConfigurationClassPostProcessoråç½®å¤„ç†å™¨è¯¦è§£</a></li><li><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Springäº‹ä»¶è®¢é˜…ä¸å‘å¸ƒåŸç†åˆ†æ.html" class="sidebar-link">Springäº‹ä»¶è®¢é˜…ä¸å‘å¸ƒåŸç†åˆ†æ</a></li></ul></section></li></ul> </aside> <div><main class="page"> <div class="theme-default-content content__default"><h2 id="_1-ç¯å¢ƒæ­å»º"><a href="#_1-ç¯å¢ƒæ­å»º" class="header-anchor">#</a> 1. ç¯å¢ƒæ­å»º</h2> <p>åˆ©ç”¨ <a href="/blog/md/springå…¨å®¶æ¡¶/spring/Springæºç ç¯å¢ƒæ­å»º/">Spring æºç ç¯å¢ƒæ­å»º</a> è¿™ç¯‡æ–‡ç« ä¸­æ­å»ºå¥½çš„ Spring æºç ç¯å¢ƒï¼Œç¼–å†™ä¸€ä¸ªå…³äº Spring BeanDefinition çš„æµ‹è¯•æ¡ˆä¾‹ï¼Œç„¶åæ ¹æ®è¯¥æµ‹è¯•æ¡ˆä¾‹å»é€æ­¥åˆ†æ Spring BeanDefinition åŠ è½½çš„æ•´ä¸ªæµç¨‹ã€‚</p> <h3 id="_1-1-åˆ›å»º-spring-beandefinition-study-æ¨¡å—"><a href="#_1-1-åˆ›å»º-spring-beandefinition-study-æ¨¡å—" class="header-anchor">#</a> 1.1. åˆ›å»º spring-beandefinition-study æ¨¡å—</h3> <p>é€‰ä¸­é¡¹ç›®å³é”®æ–°å»ºä¸€ä¸ªæ¨¡å—ï¼Œé€‰æ‹© Gradleï¼Œæ¨¡å—åå¡«è‡ªå·±å–œæ¬¢çš„å³å¯ï¼Œè¿™é‡Œæˆ‘å°±å¡« <code>spring-beandefinition-study</code>ï¼Œæœ€åç‚¹å‡»ç¡®å®šå³å¯ã€‚<br> <img alt="|1000" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220924150532.png" loading="lazy" class="lazy"></p> <h3 id="_1-2-å¼•å…¥ç›¸å…³ä¾èµ–"><a href="#_1-2-å¼•å…¥ç›¸å…³ä¾èµ–" class="header-anchor">#</a> 1.2. å¼•å…¥ç›¸å…³ä¾èµ–</h3> <p>åœ¨æ¨¡å—çš„ <code>build.gradle</code> æ–‡ä»¶ä¸­å¼•å…¥ä»¥ä¸‹ä¾èµ–ï¼š</p> <div class="language-gradle line-numbers-mode"><pre class="language-gradle"><code><span class="token keyword">dependencies</span> <span class="token punctuation">{</span>  
    testImplementation <span class="token string">'org.junit.jupiter:junit-jupiter-api:5.9.0'</span>
    testRuntimeOnly <span class="token string">'org.junit.jupiter:junit-jupiter-engine:5.9.0'</span>
    <span class="token keyword">implementation</span><span class="token punctuation">(</span><span class="token keyword">project</span><span class="token punctuation">(</span><span class="token string">':spring-context'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">implementation</span> <span class="token string">'org.slf4j:slf4j-api:2.0.3'</span>
    <span class="token keyword">implementation</span> <span class="token string">'ch.qos.logback:logback-classic:1.4.3'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_1-3-æ—¥å¿—é…ç½®æ–‡ä»¶"><a href="#_1-3-æ—¥å¿—é…ç½®æ–‡ä»¶" class="header-anchor">#</a> 1.3. æ—¥å¿—é…ç½®æ–‡ä»¶</h3> <p>ç”±äºå¼•å…¥äº† <code>logback</code>ï¼Œæ‰€ä»¥éœ€è¦åœ¨èµ„æºç›®å½• <code>resources</code> ä¸‹åˆ›å»ºä¸€ä¸ª <code>logback.xml</code> é…ç½®æ–‡ä»¶ï¼š</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CONSOLE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.ConsoleAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5p %c{1}:%L - %m%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.RollingFileAppender<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoder</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pattern</span><span class="token punctuation">&gt;</span></span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5p %c{1}:%L - %m%n<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pattern</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>charset</span><span class="token punctuation">&gt;</span></span>utf-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>charset</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoder</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>file</span><span class="token punctuation">&gt;</span></span>log/output.log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>file</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rollingPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.FixedWindowRollingPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>log/output.log.%i<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileNamePattern</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>rollingPolicy</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>triggeringPolicy</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>MaxFileSize</span><span class="token punctuation">&gt;</span></span>1MB<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>MaxFileSize</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>triggeringPolicy</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>appender</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span> <span class="token attr-name">level</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>DEBUG<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CONSOLE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>appender-ref</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>FILE<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_1-4-ç›®æ ‡ç±»"><a href="#_1-4-ç›®æ ‡ç±»" class="header-anchor">#</a> 1.4. ç›®æ ‡ç±»</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>  
   <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>  
  
   <span class="token comment">/**  
    * æ ¹æ®ç”¨æˆ·åç§°æŸ¥è¯¢ç”¨æˆ·è¯¦ç»†ä¿¡æ¯  
    *  
    * @return ç”¨æˆ·è¯¦ç»†ä¿¡æ¯  
    */</span>  
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> username <span class="token operator">+</span> <span class="token string">&quot;ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯&quot;</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> username<span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>  
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>  
   <span class="token keyword">private</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">&quot;å°ç™½&quot;</span><span class="token punctuation">;</span>  
  
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> name<span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token annotation punctuation">@Override</span>  
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> <span class="token string">&quot;People{&quot;</span> <span class="token operator">+</span>  
            <span class="token string">&quot;name='&quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>  
            <span class="token char">'}'</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_1-5-spring-æ ¸å¿ƒé…ç½®æ–‡ä»¶"><a href="#_1-5-spring-æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="header-anchor">#</a> 1.5. Spring æ ¸å¿ƒé…ç½®æ–‡ä»¶</h3> <p>åœ¨èµ„æºç›®å½• <code>resources</code> ä¸‹åˆ›å»ºä¸€ä¸ª Spring çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ <code>applicationContext.xml</code> ã€‚<br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220924152030.png" loading="lazy" class="lazy"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>  
      <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>  
      <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.xiaorang.beandefinition.service.UserService<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>  
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>å°è®©<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>  
  
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>top.xiaorang.beandefinition<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>  
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_1-6-æµ‹è¯•ç±»"><a href="#_1-6-æµ‹è¯•ç±»" class="header-anchor">#</a> 1.6. æµ‹è¯•ç±»</h3> <p>æœ€ååˆ›å»ºä¸€ä¸ªæµ‹è¯•ç±» <code>SpringBeanDefinitionTests</code>ï¼š</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanDefinitionTests</span> <span class="token punctuation">{</span>  
   <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> <span class="token constant">LOGGER</span> <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span><span class="token class-name">SpringBeanDefinitionTests</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:applicationContext.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token class-name">UserService</span> userService <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token class-name">People</span> people <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">People</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token constant">LOGGER</span><span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>people<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>æµ‹è¯•ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼šæ‰“å°å‡ºå°è®©ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠ People{name=' å°ç™½ '}ã€‚<br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220925051330.png" loading="lazy" class="lazy"><br>
æµ‹è¯•æˆåŠŸï¼Œè¾¾åˆ°é¢„æœŸæ•ˆæœï¼ğŸ‰ æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥æ ¹æ®è¯¥æµ‹è¯•æ¡ˆä¾‹å»é€æ­¥åˆ†æ SpringBeanDefinition åŠ è½½æµç¨‹çš„æ•´ä¸ªæºç ã€‚åŠ æ²¹ï¼ğŸ¯</p> <h2 id="_2-æºç åˆ†æ"><a href="#_2-æºç åˆ†æ" class="header-anchor">#</a> 2. æºç åˆ†æ</h2> <p>å› ä¸ºæ˜¯ç¬¬ä¸€ç¯‡æºç åˆ†æçš„æ–‡ç« ï¼Œæ‰€ä»¥å¯èƒ½è¯´çš„æ¯”è¾ƒå•°å—¦ç‚¹ã€‚å¥½ï¼Œç°åœ¨è®©æˆ‘ä»¬å¼€å§‹è¿›å…¥ä»Šå¤©çš„ä¸»é¢˜ï¼ŒXML ç‰ˆ Spring BeanDefinition åŠ è½½æµç¨‹ï¼Œä¸€å®šè¦è®°ä½ä»Šå¤©çš„ä¸»é¢˜ï¼Œä¸è¦è·‘åï¼</p> <blockquote><p>æºç é˜…è¯»æŠ€å·§ï¼š<strong>æŠ“ä½ä¸»æµç¨‹ï¼Œå¸¦ç€é—®é¢˜é˜…è¯»</strong>ã€‚æœ‰çš„å°ä¼™ä¼´åœ¨é˜…è¯»æºç çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“ä¸€ç›´ç‚¹è¿›æ–¹æ³•ä¸­æŸ¥çœ‹ï¼Œç„¶åå°±è¿·å¤±äº†æ–¹å‘ï¼Œä¸çŸ¥é“è‡ªå·±åˆšæ‰å¹²äº†å•¥ï¼Œç„¶ååˆè¦é‡æ–°æ¥è¿‡ï¼Œæ‰€ä»¥å…ˆæŠŠä¸»æµç¨‹ç»™ææ¸…æ¥šï¼Œä¸è¦è·‘åï¼ä¹‹åï¼Œæœ‰éœ€è¦çš„è¯å¯ä»¥å†å»åˆ†æåˆ†æ”¯æƒ…å†µã€‚</p></blockquote> <p>ä»æµ‹è¯•æ¡ˆä¾‹å…¥æ‰‹ï¼Œç¬¬ä¸€è¡Œä»£ç å°±åˆ›å»ºäº†ä¸€ä¸ª <code>ClassPathXmlApplicationContext</code> åº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ ï¼Œå°† Spring çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ <code>applicationContext.xml</code> è·¯å¾„ä½œä¸ºå‚æ•°ä¼ å…¥æ„é€ å‡½æ•°ä¸­ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">String</span> configLocation<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>  
   <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>configLocation<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span>  
      <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations<span class="token punctuation">,</span> <span class="token keyword">boolean</span> refresh<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ApplicationContext</span> parent<span class="token punctuation">)</span>  
      <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>  
  
   <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token function">setConfigLocations</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>refresh<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
	  <span class="token comment">// å®¹å™¨åˆ·æ–°</span>
      <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å¯ä»¥çœ‹åˆ°åœ¨å…¶é‡è½½çš„æ„é€ æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨ <code>setConfigLocations(configLocations)</code> æ–¹æ³•å°†ä¼ å…¥è¿›æ¥çš„ Spring é…ç½®æ–‡ä»¶è·¯å¾„ä¿å­˜èµ·æ¥ï¼Œç”¨äºåé¢åŠ è½½ bean å®šä¹‰ä¿¡æ¯æ—¶çŸ¥é“ä»å“ªå»åŠ è½½ bean å®šä¹‰ä¿¡æ¯ã€‚ç„¶åæœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„ <strong>å®¹å™¨åˆ·æ–°æ–¹æ³• <code>refresh()</code></strong>ï¼Œè¯¥æ–¹æ³•ä½äºçˆ¶ç±» <strong><code>AbstractApplicationContext</code></strong> ä¸­ï¼Œåˆ†æ Spring æºç å°±æ²¡æœ‰ä¸è®²è¯¥æ–¹æ³•çš„ï¼Œè¯¥ <code>refresh()</code> æ–¹æ³•æ˜¯é‡ä¸­ä¹‹é‡ï¼Œä¸€å®šè¦è®°ä½ï¼ˆè‡ªå·±å¤šåˆ·å‡ éè‡ªç„¶å°±è®°ä½äº†ï¼‰ï¼ æ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œ<strong>è¯¥ <code>refresh()</code> æ–¹æ³•æ˜¯æ•´ä¸ª Spring æºç åˆ†æçš„å…¥å£</strong>ã€‚å…³äº Spring å®¹å™¨åˆ·æ–° <code>refresh()</code> æ–¹æ³•çš„åäºŒå¤§æ­¥ï¼Œå°ä¼™ä¼´ä»¬åº”è¯¥éƒ½æœ‰æ‰€è€³é—»ã€‚</p> <h3 id="_2-1-æºç åˆ†æå…¥å£"><a href="#_2-1-æºç åˆ†æå…¥å£" class="header-anchor">#</a> 2.1. æºç åˆ†æå…¥å£</h3> <blockquote><p>Spring å®¹å™¨åˆå§‹åŒ–æ ¸å¿ƒæ–¹æ³• AbstractApplicationContext#refresh</p></blockquote> <ul><li><code>â”œâ”€</code>Â refreshÂ Spring åˆå§‹åŒ–æ ¸å¿ƒæµç¨‹å…¥å£</li> <li><code>â”‚ â”œâ”€</code>Â prepareRefreshÂ â‘  ä¸Šä¸‹æ–‡åˆ·æ–°å‰çš„å‡†å¤‡å·¥ä½œï¼Œè®¾ç½®å¯åŠ¨æ—¶é—´å’Œ active æ ‡å¿—ï¼Œåˆå§‹åŒ–å±æ€§</li> <li><code>â”‚ â”œâ”€</code> <strong>obtainFreshBeanFactory</strong> <span style="background:#affad1;">Â â‘¡ åˆ›å»º bean å·¥å‚å®ä¾‹ä»¥åŠåŠ è½½ bean å®šä¹‰ä¿¡æ¯åˆ° bean å·¥å‚</span></li> <li><code>â”‚ â”œâ”€</code>Â prepareBeanFactoryÂ â‘¢ è®¾ç½® beanFactory çš„åŸºæœ¬å±æ€§</li> <li><code>â”‚ â”œâ”€</code>Â postProcessBeanFactoryÂ â‘£ å­ç±»å¤„ç†è‡ªå®šä¹‰çš„ BeanFactoryPostProcess</li> <li><code>â”‚ â”œâ”€</code>Â invokeBeanFactoryPostProcessorsÂ â‘¤ å®ä¾‹åŒ–å¹¶è°ƒç”¨æ‰€æœ‰ bean å·¥å‚åç½®å¤„ç†å™¨</li> <li><code>â”‚ â”œâ”€</code>Â registerBeanPostProcessorsÂ â‘¥ æ³¨å†Œï¼ŒæŠŠå®ç°äº† BeanPostProcessor æ¥å£çš„ç±»å®ä¾‹åŒ–ï¼ŒåŠ åˆ° BeanFactory</li> <li><code>â”‚ â”œâ”€</code>Â initMessageSourceÂ â‘¦ åˆå§‹åŒ–ä¸Šä¸‹æ–‡ä¸­çš„èµ„æºæ–‡ä»¶ï¼Œå¦‚å›½é™…åŒ–æ–‡ä»¶çš„å¤„ç†ç­‰</li> <li><code>â”‚ â”œâ”€</code>Â initApplicationEventMulticasterÂ â‘§ åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨</li> <li><code>â”‚ â”œâ”€</code>Â onRefreshÂ â‘¨ ç»™å­ç±»æ‰©å±•åˆå§‹åŒ–å…¶ä»– Beanï¼Œspringboot ä¸­ç”¨æ¥åšå†…åµŒ tomcat å¯åŠ¨</li> <li><code>â”‚ â”œâ”€</code>Â registerListenersÂ â‘© æ³¨å†Œç›‘å¬å™¨</li> <li><code>â”‚ â”œâ”€</code>Â finishBeanFactoryInitializationÂ â‘ª å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½çš„å•å®ä¾‹ bean</li> <li><code>â”‚ â””â”€</code>Â finishRefreshÂ â‘« å®Œæˆåˆ·æ–°è¿‡ç¨‹ï¼Œå‘å¸ƒä¸Šä¸‹æ–‡åˆ·æ–°å®Œæˆäº‹ä»¶</li></ul> <p>å…¶ä¸­ï¼Œç»¿è‰²ä»£è¡¨æœ¬æ¬¡æºç åˆ†æçš„é‡ç‚¹æ­¥éª¤ã€‚</p> <p>æœ¬èŠ‚æºç åˆ†ææ˜¯åŸºäº <code>obtainFreshBeanFactory()</code> æ–¹æ³•å†…çš„æ‰§è¡Œæµç¨‹ï¼Œä¸»è¦åŒ…æ‹¬ï¼šåˆ›å»ºå¡«å…… <code>BeanFactory</code>ã€xml æ ‡ç­¾çš„è§£æå¹¶å¡«å……åˆ° <code>BeanDefinition</code>ã€å¹¶æ³¨å†Œåˆ° Spring IOC å®¹å™¨ã€‚è¯¥æ–¹æ³•ç®—æ˜¯ <strong>Spring å®¹å™¨åˆ·æ–°åäºŒå¤§æ­¥ä¸­çš„ç¬¬äºŒå¤§æ­¥ï¼šåˆ›å»º bean å·¥å‚å®ä¾‹ä»¥åŠåŠ è½½ bean å®šä¹‰ä¿¡æ¯åˆ° bean å·¥å‚</strong>ã€‚å…¶ä½™çš„æ­¥éª¤ä¼šåœ¨åç»­æºç åˆ†æçš„æ–‡ç« ä¸­ä¼šé€ä¸ªåˆ†æã€‚</p> <h3 id="_2-2-åˆ›å»º-beanfactory-å®ä¾‹"><a href="#_2-2-åˆ›å»º-beanfactory-å®ä¾‹" class="header-anchor">#</a> 2.2. åˆ›å»º BeanFactory å®ä¾‹</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>
	<span class="token comment">// çœç•¥...</span>
    <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// çœç•¥...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>åœ¨ <code>obtainFreshBeanFactory()</code> æ–¹æ³•ä¸­ï¼Œæœ‰ä¸€ä¸ªåˆ·æ–° BeanFactory çš„æ–¹æ³• <code>refreshBeanFactory()</code>ï¼Œè¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè®©å­ç±»å»å®ç°ï¼Œå…¸å‹çš„ <strong>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</strong>ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ConfigurableListableBeanFactory</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
   <span class="token keyword">return</span> <span class="token function">getBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç”±äºå’±ä»¬ä½¿ç”¨çš„æ˜¯åº”ç”¨ä¸Šä¸‹æ–‡æ˜¯ <code>ClassPathXmlApplicationContext</code> ï¼ŒF4 æŸ¥çœ‹ <code>ApplicationContext</code> çš„ç»§æ‰¿ç»“æ„ä½“ç³»å¯ä»¥å‘ç°<br> <code>|-</code> <code>AbstractApplicationContext</code><br> <code>|-</code> <code>AbstractRefreshableApplicationContext</code><br> <code>|-</code> <code>AbstractRefreshableConfigApplicationContext</code><br> <code>|-</code> <code>AbstractXmlApplicationContext</code><br> <code>|-</code> <code>ClassPathXmlApplicationContext</code><br>
åœ¨ <code>ClassPathXmlApplicationContext</code> çš„çˆ¶ç±»ï¼Œ <code>AbstractApplicationContext</code> çš„å­ç±» <code>AbstractRefreshableApplicationContext</code> ä¸­å®ç°äº†è¯¥æ–¹æ³•ã€‚<br> <img alt="ApplicationContextç»§æ‰¿ç»“æ„ä½“ç³»" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/ApplicationContext.svg" loading="lazy" class="lazy"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">refreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// é”€æ¯ BeanFactory</span>
        <span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å…³é—­å®¹å™¨ BeanFactory</span>
        <span class="token function">closeBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
		 * ä¸º Spring åº”ç”¨ä¸Šä¸‹æ–‡åˆ›å»º spring çš„åˆçº§å®¹å™¨ BeanFactoryï¼Œå³åˆ›å»º DefaultListableBeanFactory
		 * æ˜¯ä¿å­˜æ‰€æœ‰ BeanDefinition çš„æ¡£æ¡ˆé¦†
		 */</span>
        <span class="token class-name">DefaultListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">createBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ä¸ºå®¹å™¨è®¾ç½®ä¸€ä¸ªåºåˆ—åŒ– ID</span>
        beanFactory<span class="token punctuation">.</span><span class="token function">setSerializationId</span><span class="token punctuation">(</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// å®šåˆ¶è¯ spring çš„åˆçº§å®¹å™¨ BeanFactory</span>
        <span class="token function">customizeBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åŠ è½½ bean å®šä¹‰ä¿¡æ¯ã€‚ï¼ˆå¼€å§‹è§£æå¹¶åŠ è½½ xml æ–‡ä»¶ä¸­çš„ beanï¼‰</span>
        <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory <span class="token operator">=</span> beanFactory<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ApplicationContextException</span><span class="token punctuation">(</span><span class="token string">&quot;I/O error parsing bean definition source for &quot;</span> <span class="token operator">+</span> <span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>è¯¥æ–¹æ³•ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯ <code>createBeanFactory()</code> æ–¹æ³•ï¼Œåˆ›å»º <code>BeanFactory</code> çš„å®ä¾‹å¯¹è±¡ï¼›å¦å¤–ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ <code>loadBeanDefinitions(beanFactory)</code>ï¼Œè§£æå¹¶åŠ è½½ XML é…ç½®ä¸­é…ç½®çš„æ‰€æœ‰ bean å®šä¹‰ä¿¡æ¯ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">DefaultListableBeanFactory</span> <span class="token function">createBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultListableBeanFactory</span><span class="token punctuation">(</span><span class="token function">getInternalParentBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>è¯¥æ–¹æ³•æœ€ä¸»è¦çš„ä½œç”¨å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ª <code>BeanFactory</code> çš„å­ç±» <code>DefaultListableBeanFactory</code> çš„å®ä¾‹å¯¹è±¡ã€‚</p> <blockquote><p>é¢˜å¤–è¯ï¼šåˆæ¬¡é˜…è¯» Spring æºç çš„å°ä¼™ä¼´ï¼Œè‚¯å®šä¼šå¯¹ <code>BeanFactory</code> æ„Ÿåˆ°é™Œç”Ÿï¼Œåˆ«æ€•ï¼Œå…¶å®åé¢å¤šé˜…è¯»å‡ éæºç ï¼Œä½ å°±ä¼šè§‰å¾—åˆ«æ²¡æœ‰ä»€ä¹ˆï¼Œä¸ç®¡æ˜¯é˜…è¯»ä»€ä¹ˆæºç éƒ½æ˜¯è¿™æ ·ï¼Œå¤šå€Ÿé‰´ä¸€ä¸‹å‰è¾ˆä»¬çš„ç»éªŒï¼Œä¸è¦é—­é—¨é€ è½¦ï¼</p></blockquote> <p>å…ˆæ¥çœ‹ä¸‹ <code>BeanFactory</code> çš„ç»§æ‰¿ç»“æ„ä½“ç³»ï¼Œå¯¹ <code>BeanFactory</code> æœ‰ä¸€ä¸ªå®è§‚ä¸Šçš„è®¤è¯†ã€‚<br> <img alt="BeanFactoryç»§æ‰¿ç»“æ„ä½“ç³»" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/BeanFactory.svg" loading="lazy" class="lazy"></p> <blockquote><p>é¦–å…ˆéœ€è¦çŸ¥é“çš„æ˜¯ï¼Œ<strong>å¦‚æœä¸€ä¸ªç±»å®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆå°±å…·å¤‡äº†è¯¥æ¥å£çš„èƒ½åŠ›ï¼›å¦‚æœä¸€ä¸ªæ¥å£ç»§æ‰¿è‡ªå¦ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆè¯¥æ¥å£å°±ä¼šåŒæ—¶å…·å¤‡å¦ä¸€ä¸ªæ¥å£æ‰€å…·å¤‡çš„èƒ½åŠ›ã€‚</strong></p></blockquote> <h4 id="_2-2-1-beandefinitionregistry"><a href="#_2-2-1-beandefinitionregistry" class="header-anchor">#</a> 2.2.1. BeanDefinitionRegistry</h4> <p>åˆ«è¢«ä¸Šé¢ <code>BeanFactory</code> çš„ç»§æ‰¿ç»“æ„ä½“ç³»å›¾ç»™å¼„æ™•ï¼Œå’±ä»¬åªå…³æ³¨ä¸ä»Šå¤©ä¸»é¢˜ç›¸å…³çš„ï¼Œè‡³äº <code>BeanFactory</code> è¿˜å…·å¤‡ä»€ä¹ˆèƒ½åŠ›ï¼Œå°±ç•™åœ¨ä»¥åçš„æ–‡ç« ä¸­åˆ†æã€‚</p> <blockquote><p>æå‰å‰§é€ä¸€ä¸‹ï¼Œç›¸ä¿¡çœ¼å°–çš„å°ä¼™ä¼´å·²ç»å‘ç° <code>DefaultListableBeanFactory</code> çš„çˆ¶ç±»å®ç°äº† <code>SingletonBeanRegistry</code> æ¥å£ï¼Œçœ‹åå­—ä¸éš¾çŒœå‡ºï¼Œè¯¥æ¥å£ä½œä¸ºå•å®ä¾‹ bean çš„æ³¨å†Œä¸­å¿ƒï¼Œé‚£ä¹ˆ <code>BeanFactory</code> è‚¯å®šå…·å¤‡äº†å…¶æœ€ä¸»è¦çš„èƒ½åŠ›ï¼Œç®¡ç†å•å®ä¾‹ bean ã€‚</p></blockquote> <p>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ° <strong><code>DefaultListableBeanFactory</code> å®ç°äº† <code>BeanDefinitionRegistry</code> æ¥å£</strong>ï¼Œé‚£ä¹ˆå°±å…·å¤‡äº† <code>BeanDefinitionRegistry</code> æ¥å£çš„èƒ½åŠ›ï¼Œè¯¥æ¥å£æœ‰ä»€ä¹ˆèƒ½åŠ›å‘¢ï¼Ÿçœ‹åå­—å°±çŸ¥é“æ˜¯ <strong>bean å®šä¹‰ä¿¡æ¯çš„æ³¨å†Œä¸­å¿ƒï¼Œç”¨äºç®¡ç†æ‰€æœ‰çš„ bean å®šä¹‰ä¿¡æ¯</strong>ï¼Œä» XML æ–‡ä»¶ä¸­è§£æå‡º bean å®šä¹‰ä¿¡æ¯åå°±éœ€è¦äº¤ç»™ <code>BeanDefinitionRegistry</code> ç®¡ç†ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanDefinitionRegistry</span> <span class="token keyword">extends</span> <span class="token class-name">AliasRegistry</span> <span class="token punctuation">{</span>
	<span class="token comment">// æ³¨å†ŒæŸä¸ªbeançš„å®šä¹‰ä¿¡æ¯</span>
	<span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">;</span>

	<span class="token comment">// åˆ é™¤æŸä¸ªbeançš„å®šä¹‰ä¿¡æ¯</span>
	<span class="token keyword">void</span> <span class="token function">removeBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchBeanDefinitionException</span><span class="token punctuation">;</span>

	<span class="token comment">// è·å–æŸä¸ªbeançš„å®šä¹‰ä¿¡æ¯</span>
	<span class="token class-name">BeanDefinition</span> <span class="token function">getBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchBeanDefinitionException</span><span class="token punctuation">;</span>

	<span class="token comment">// æ˜¯å¦å­˜åœ¨æŸä¸ªæŸä¸ªbeançš„å®šä¹‰ä¿¡æ¯</span>
	<span class="token keyword">boolean</span> <span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// è·å–æ‰€æœ‰beanå®šä¹‰ä¿¡æ¯çš„åç§°</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// è·å–æ‰€æœ‰beanå®šä¹‰ä¿¡æ¯çš„æ•°é‡</span>
	<span class="token keyword">int</span> <span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// åˆ¤æ–­å½“å‰beanå®šä¹‰ä¿¡æ¯çš„åç§°æ˜¯å¦æ­£åœ¨ä½¿ç”¨</span>
	<span class="token keyword">boolean</span> <span class="token function">isBeanNameInUse</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>é‚£ä¹ˆ <code>DefaultListableBeanFactory</code> ä½œä¸º <code>BeanDefinitionRegistry</code> æ¥å£çš„å®ç°ç±»ï¼Œæ˜¯å¦‚ä½•å®ç° <code>BeanDefinitionRegistry</code> æ¥å£çš„å‘¢ï¼Ÿ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultListableBeanFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractAutowireCapableBeanFactory</span>
		<span class="token keyword">implements</span> <span class="token class-name">ConfigurableListableBeanFactory</span><span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

	<span class="token comment">/** Map of bean definition objects, keyed by bean name. */</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> beanDefinitionMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/** List of bean definition names, in registration order. */</span>
	<span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> beanDefinitionNames <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token class-name">BeanDefinition</span> beanDefinition<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchBeanDefinitionException</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
		<span class="token class-name">BeanDefinition</span> bd <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionMap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// ...	</span>
		<span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanDefinitionNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ...</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>è§‚å¯Ÿä¸Šé¢æºç ä¸éš¾å‘ç°ï¼Œåœ¨ <code>DefaultListableBeanFactory</code> ä¸­å®šä¹‰äº†ä¸¤ä¸ªé›†åˆï¼Œå…¶ä¸­ <strong><code>beanDefinitionMap</code> é›†åˆç”¨æ¥ä¿å­˜æ³¨å†Œçš„ bean å®šä¹‰ä¿¡æ¯ï¼ŒKey æ˜¯ bean çš„åç§°ï¼ŒValue æ˜¯ <code>BeanDefinition</code> çš„å®ä¾‹å¯¹è±¡</strong>ï¼›å¦å¤–ä¸€ä¸ª List é›†åˆä¸“é—¨ç”¨æ¥ä¿å­˜æ³¨å†Œçš„ bean å®šä¹‰ä¿¡æ¯çš„åç§°ã€‚è‡³äº <code>BeanDefinitionRegistry</code> æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•åœ¨ <code>DefaultListableBeanFactory</code> ä¸­å®ç°èµ·æ¥ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯æ“ä½œè¿™ä¸¤ä¸ªé›†åˆã€‚ä¸€ä¸ª bean å®šä¹‰ä¿¡æ¯çš„æ³¨å†Œä¸­å¿ƒå°±æ˜¯è¿™æ ·å®ç°çš„ï¼Œæ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼</p> <h4 id="_2-2-2-beandefinition"><a href="#_2-2-2-beandefinition" class="header-anchor">#</a> 2.2.2. BeanDefinition</h4> <h5 id="_2-2-2-1-ç®€ä»‹"><a href="#_2-2-2-1-ç®€ä»‹" class="header-anchor">#</a> 2.2.2.1. ç®€ä»‹</h5> <p>æœ‰å°ä¼™ä¼´å¯èƒ½ä¼šå¯¹ <code>BeanDefinition</code> æ„Ÿåˆ°ç–‘æƒ‘ï¼Œè¿™æ˜¯ä»€ä¹ˆä¸œä¸œï¼Ÿæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæ ¹æ®å®ƒçš„åå­—ä¸éš¾çŒœå‡º <strong>bean çš„å®šä¹‰ä¿¡æ¯</strong>ã€‚äº‹å®ä¸Šå°±æ˜¯è¿™æ ·ï¼Œå’±ä»¬åœ¨ XML é…ç½®æ–‡ä»¶ä¸­çš„ bean æ ‡ç­¾ä¸­é…ç½®çš„å„ç§å±æ€§ï¼Œè¿™äº›å±æ€§ä¸ä»…ä»…æ˜¯å’Œ Bean å¯¹è±¡ç›¸å…³ï¼Œè¿˜å’Œ Bean çš„ç”Ÿå‘½å‘¨æœŸã€é”€æ¯ã€åˆå§‹åŒ–ç­‰ç­‰å„ç§æ“ä½œæœ‰å…³ï¼Œå’±ä»¬å®šä¹‰çš„å…³äº Bean çš„ç”Ÿå‘½å‘¨æœŸã€é”€æ¯ã€åˆå§‹åŒ–ç­‰æ“ä½œæ€»å¾—æœ‰ä¸€ä¸ªå¯¹è±¡æ¥æ‰¿è½½ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯ BeanDefinitionã€‚</p> <blockquote><p>å¯¹äº Spring XML å¼€å‘ä¸æ¸…æ¥šçš„å°ä¼™ä¼´ï¼Œå¯ä»¥å‚è€ƒæœ¬ç¯‡æ–‡ç«  <a href="/blog/md/springå…¨å®¶æ¡¶/åŸºç¡€/IOC/">Spring-IOC</a>ï¼Œé‡Œé¢è¯´äº† Spring åŸºäº XML æ˜¯æ€æ ·ä½¿ç”¨çš„ã€‚</p></blockquote> <p><strong>åœ¨ XML çš„ bean æ ‡ç­¾ä¸­å®šä¹‰çš„å„ç§ Bean çš„å±æ€§éƒ½ä¼šå…ˆåŠ è½½åˆ° BeanDefinition ä¸Šï¼Œç„¶å Spring å®¹å™¨æ ¹æ® BeanDefinition æ¥ç”Ÿæˆä¸€ä¸ª Bean å®ä¾‹å¯¹è±¡</strong>ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼ŒBeanDefinition å’Œ Bean çš„å…³ç³»æœ‰ç‚¹ç±»ä¼¼äºç±»å’Œå¯¹è±¡çš„å…³ç³»ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanDefinition</span> <span class="token keyword">extends</span> <span class="token class-name">AttributeAccessor</span><span class="token punctuation">,</span> <span class="token class-name">BeanMetadataElement</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> <span class="token constant">SCOPE_SINGLETON</span> <span class="token operator">=</span> <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span><span class="token constant">SCOPE_SINGLETON</span><span class="token punctuation">;</span>
	<span class="token class-name">String</span> <span class="token constant">SCOPE_PROTOTYPE</span> <span class="token operator">=</span> <span class="token class-name">ConfigurableBeanFactory</span><span class="token punctuation">.</span><span class="token constant">SCOPE_PROTOTYPE</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> <span class="token constant">ROLE_APPLICATION</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> <span class="token constant">ROLE_SUPPORT</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> <span class="token constant">ROLE_INFRASTRUCTURE</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setParentName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> parentName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getParentName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setBeanClassName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> beanClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setScope</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setLazyInit</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> lazyInit<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> <span class="token function">isLazyInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setDependsOn</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> dependsOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getDependsOn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setAutowireCandidate</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> autowireCandidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> <span class="token function">isAutowireCandidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setPrimary</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> primary<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> <span class="token function">isPrimary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setFactoryBeanName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> factoryBeanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getFactoryBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setFactoryMethodName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> factoryMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getFactoryMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ConstructorArgumentValues</span> <span class="token function">getConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">hasConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">getConstructorArgumentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">MutablePropertyValues</span> <span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">hasPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">getPropertyValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">setInitMethodName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> initMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getInitMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setDestroyMethodName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> destroyMethodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getDestroyMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setRole</span><span class="token punctuation">(</span><span class="token keyword">int</span> role<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> <span class="token function">getRole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> description<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">ResolvableType</span> <span class="token function">getResolvableType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> <span class="token function">isPrototype</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> <span class="token function">isAbstract</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">String</span> <span class="token function">getResourceDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token annotation punctuation">@Nullable</span>
	<span class="token class-name">BeanDefinition</span> <span class="token function">getOriginatingBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><p>BeanDefinition ä¸­çš„æ–¹æ³•è™½ç„¶å¤šï¼Œä½†æ˜¯ç»“åˆæˆ‘ä»¬å¹³æ—¶åœ¨ XML ä¸­çš„é…ç½®ï¼Œè¿™äº›æ–¹æ³•å…¶å®éƒ½å¾ˆå¥½ç†è§£ï¼Œåˆ—ä¸¾ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š<span style="background:rgba(240, 200, 0, 0.2);">TODO</span> å®Œå–„ä¸€ä¸‹</p> <ol><li>é¦–å…ˆä¸€å¼€å§‹å®šä¹‰äº†ä¸¤ä¸ªå˜é‡ç”¨æ¥æè¿° Bean æ˜¯ä¸æ˜¯å•ä¾‹çš„ï¼Œåé¢çš„ setScope/getScope æ–¹æ³•å¯ä»¥ç”¨æ¥ä¿®æ”¹/è·å– scope å±æ€§ã€‚</li> <li>setBeanClassName/getBeanClassName è¿™ä¸ªå°±æ˜¯é…ç½® <strong>Bean çš„ Class å…¨è·¯å¾„</strong>ï¼Œå¯¹åº” XML ä¸­çš„ <code>&lt;bean class=&quot;&quot;&gt;</code> é…ç½®ã€‚</li> <li>setLazyInit/isLazyInit é…ç½®/è·å– <strong>Bean æ˜¯å¦æ‡’åŠ è½½</strong>ï¼Œè¿™ä¸ªå¯¹åº”äº† XML ä¸­çš„ <code>&lt;bean lazy-init=&quot;&quot;&gt;</code> é…ç½®ã€‚</li> <li>setAutowireCandidate/isAutowireCandidate é…ç½®/è·å– Bean æ˜¯å¦æ˜¯è‡ªåŠ¨è£…é…ï¼Œå¯¹åº”äº† XML ä¸­çš„ <code>&lt;bean autowire-candidate=&quot;&quot;&gt;</code> é…ç½®ã€‚</li> <li>setPrimary/isPrimary é…ç½®/è·å– <strong>å½“å‰ Bean æ˜¯å¦ä¸ºé¦–é€‰çš„ Bean</strong>ï¼Œå¯¹åº”äº† XML ä¸­çš„ <code>&lt;bean primary=&quot;&quot;&gt;</code> é…ç½®ã€‚</li> <li>setFactoryBeanName/getFactoryBeanName é…ç½®/è·å– <strong>FactoryBean</strong> çš„åå­—ï¼Œ<strong>å®ä¾‹å·¥å‚åˆ›å»ºå¯¹è±¡</strong>ï¼Œå¯¹åº”äº† XML ä¸­çš„ <code>&lt;bean factory-bean=&quot;&quot;&gt;</code> é…ç½®ã€‚</li> <li>setFactoryMethodName/getFactoryMethodName å’Œä¸Šä¸€æ¡æˆå¯¹å‡ºç°çš„ï¼Œ<strong>é™æ€å·¥å‚åˆ›å»ºå¯¹è±¡</strong>ï¼Œå¯¹åº”äº† XML ä¸­çš„ <code>&lt;bean factory-method=&quot;&quot;&gt;</code> é…ç½®ï¼Œä¸å†èµ˜è¿°</li> <li>getConstructorArgumentValues è¿”å›è¯¥ Bean æ„é€ æ–¹æ³•çš„å‚æ•°å€¼ã€‚</li> <li>getPropertyValues è¿™ä¸ªæ˜¯ <strong>è·å–æ™®é€šå±æ€§çš„é›†åˆ</strong>ã€‚</li> <li>setInitMethodName/setDestroyMethodName <strong>é…ç½® Bean çš„åˆå§‹åŒ–æ–¹æ³•ã€é”€æ¯æ–¹æ³•</strong>ã€‚</li> <li>isSingleton Bean æ˜¯å¦ä¸ºå•ä¾‹ã€‚</li> <li>isPrototype Bean æ˜¯å¦ä¸ºåŸå‹ã€‚</li> <li>isAbstract Bean æ˜¯å¦æŠ½è±¡ã€‚</li> <li>getOriginatingBeanDefinition å¦‚æœå½“å‰ BeanDefinition æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥è¿”å›åŸå§‹çš„ BeanDefinition ã€‚</li></ol> <p>è¿™ä¸ªå°±æ˜¯ BeanDefinition çš„å®šä¹‰ä»¥åŠå®ƒé‡Œè¾¹æ–¹æ³•çš„å«ä¹‰ã€‚</p> <h5 id="_2-2-2-2-ç»§æ‰¿ä½“ç³»"><a href="#_2-2-2-2-ç»§æ‰¿ä½“ç³»" class="header-anchor">#</a> 2.2.2.2. ç»§æ‰¿ä½“ç³»</h5> <p><img alt="BeanDefinition" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/BeanDefinition.svg" loading="lazy" class="lazy"><br>
è¿™ä¹ˆå¤šå®ç°ç±»çœ‹ç€æœ‰ç‚¹çœ¼èŠ±ç¼­ä¹±ï¼Œä¸è¿‡ææ¸…æ¥šäº†æ¯ä¸€ä¸ªæ¥å£å’Œç±»çš„ä½œç”¨ï¼Œå†çœ‹å°±å¾ˆå®¹æ˜“äº†ã€‚</p> <ol><li>AbstractBeanDefinitionï¼ŒAbstractBeanDefinition æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ ¹æ® BeanDefinition ä¸­å®šä¹‰çš„æ¥å£æä¾›äº†ç›¸åº”çš„å±æ€§ï¼Œå¹¶å®ç°äº† BeanDefinition ä¸­å®šä¹‰çš„ä¸€éƒ¨åˆ†æ–¹æ³•ã€‚BeanDefinition ä¸­åŸæœ¬åªæ˜¯å®šä¹‰äº†ä¸€ç³»åˆ—çš„ get/set æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰æä¾›å¯¹åº”çš„å±æ€§ï¼Œåœ¨ AbstractBeanDefinition ä¸­å°†æ‰€æœ‰çš„å±æ€§å®šä¹‰å‡ºæ¥äº†ã€‚åé¢å…¶ä»–çš„å®ç°ç±»ä¹ŸåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨ AbstractBeanDefinition çš„åŸºç¡€ä¸Šå®Œæˆçš„ã€‚</li> <li>RootBeanDefinitionï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„å®ç°ç±»ï¼Œå¯¹åº”äº†ä¸€èˆ¬çš„å…ƒç´ æ ‡ç­¾ã€‚</li> <li>ChildBeanDefinitionï¼Œå¯ä»¥è®©å­ BeanDefinition å®šä¹‰æ‹¥æœ‰ä»çˆ¶ BeanDefinition é‚£é‡Œç»§æ‰¿é…ç½®çš„èƒ½åŠ›ã€‚</li> <li>GenericBeanDefinitionï¼ŒGenericBeanDefinition æ˜¯ä» Spring2.5 ä»¥åæ–°åŠ å…¥çš„ BeanDefinition å®ç°ç±»ã€‚GenericBeanDefinition å¯ä»¥åŠ¨æ€è®¾ç½®çˆ¶ Beanï¼ŒåŒæ—¶å…¼å…· RootBeanDefinition å’Œ ChildBeanDefinition çš„åŠŸèƒ½ã€‚</li> <li>AnnotatedBeanDefinitionï¼Œ<strong>è¡¨ç¤ºæ³¨è§£ç±»å‹ BeanDefinitionï¼Œæ‹¥æœ‰è·å–æ³¨è§£å…ƒæ•°æ®å’Œæ–¹æ³•å…ƒæ•°æ®çš„èƒ½åŠ›</strong>ã€‚</li> <li>AnnotatedGenericBeanDefinitionï¼Œä½¿ç”¨äº† <strong>@Configuration æ³¨è§£æ ‡è®°é…ç½®ç±»ä¼šè§£æä¸º AnnotatedGenericBeanDefinition</strong>ã€‚</li></ol> <h5 id="_2-2-2-3-å®è·µ"><a href="#_2-2-2-3-å®è·µ" class="header-anchor">#</a> 2.2.2.3. å®è·µ</h5> <p>ç†è®ºè®²äº†è¿™ä¹ˆå¤šï¼Œå°±ä»¥å’±ä»¬çš„ <code>UserService</code> ä¸ºä¾‹ï¼Œæ‰“ä¸ªæ–­ç‚¹æ¥çœ‹ä¸‹ <code>UserService</code> çš„ bean å®šä¹‰ä¿¡æ¯é•¿ä»€ä¹ˆæ ·ã€‚åœ¨å“ªæ‰“æ–­ç‚¹å‘¢ï¼Ÿæ ¹æ®ä¸Šé¢å·²ç»åˆ†æå‡ºçš„ï¼Œ <code>DefaultListableBeanFactory</code> ä½œä¸º bean å®šä¹‰ä¿¡æ¯çš„æ³¨å†Œä¸­å¿ƒï¼Œé‚£ä¹ˆå’±ä»¬ç›´æ¥åœ¨è¯¥ç±»çš„ <code>registerBeanDefinition()</code> æ–¹æ³•ä¸­æ‰“ä¸€ä¸ªæ–­ç‚¹ã€‚<br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220924183702.png" loading="lazy" class="lazy"><br>
å¯ä»¥çœ‹åˆ°å°† XML é…ç½®æ–‡ä»¶ä¸­çš„ <code>bean</code> æ ‡ç­¾ä¸­çš„ <code>id</code> ä½œä¸º <code>beanName</code>ï¼Œ<code>BeanDefinition</code> å®ä¾‹å¯¹è±¡ä¸­çš„ <code>beanClass</code> å±æ€§ = <code>bean</code> æ ‡ç­¾ä¸­çš„ <code>class</code> å±æ€§ ï¼Œ<code>propertyValues</code> å±æ€§ = <code>property</code> æ ‡ç­¾ä¸­çš„ <code>name</code> å’Œ <code>value</code> å±æ€§ã€‚å’±ä»¬åœ¨ XML é…ç½®æ–‡ä»¶ä¸­ä¹¦å†™çš„ <code>bean</code> æ ‡ç­¾å°±ä¼šå¯¹åº”ä¸€ä¸ª <code>BeanDefinition</code> å®ä¾‹å¯¹è±¡ï¼Œ<code>bean</code> æ ‡ç­¾ä¸­çš„å±æ€§å°±ä¼šå¯¹åº”åˆ° <code>BeanDefinition</code> å®ä¾‹å¯¹è±¡ä¸­ç›¸å¯¹åº”çš„å±æ€§ã€‚Spring å®¹å™¨å°±ä¼šæ ¹æ®è¿™ä¸€ä»½ bean å®šä¹‰ä¿¡æ¯å›¾çº¸å»ç”Ÿäº§ç›¸å¯¹åº”çš„ bean å®ä¾‹å¯¹è±¡ã€‚</p> <h3 id="_2-3-è§£æ-xml-é…ç½®æ–‡ä»¶å¹¶åŠ è½½-bean-å®šä¹‰ä¿¡æ¯"><a href="#_2-3-è§£æ-xml-é…ç½®æ–‡ä»¶å¹¶åŠ è½½-bean-å®šä¹‰ä¿¡æ¯" class="header-anchor">#</a> 2.3. è§£æ XML é…ç½®æ–‡ä»¶å¹¶åŠ è½½ bean å®šä¹‰ä¿¡æ¯</h3> <p><code>BeanFactory</code> åˆ›å»ºå®Œæˆåï¼Œå°±å¼€å§‹è§£æ XML é…ç½®æ–‡ä»¶å¹¶åŠ è½½ bean å®šä¹‰ä¿¡æ¯ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>è¯¥æ–¹æ³•ä¹Ÿæ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œç•™ç»™å­ç±»å»å®ç°ã€‚åœ¨ <code>ClassPathXmlApplicationContext</code> çš„çˆ¶ç±»ï¼Œ <code>AbstractRefreshableApplicationContext</code> çš„å­ç±» <code>AbstractXmlApplicationContext</code> ä¸­å®ç°äº†è¯¥æ–¹æ³•ã€‚</p> <blockquote><p>æºç é˜…è¯»æŠ€å·§ï¼š<strong>å¤§èƒ†çŒœæµ‹ï¼Œå°å¿ƒæ±‚è¯</strong>ã€‚ä¸è¦æ€•å»çŒœæµ‹æŸä¸ªç±»ã€æ–¹æ³•ã€å±æ€§ã€é€»è¾‘æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Œåæ­£ä¸æ”¶é’±ï¼Œæ€•ä»€ä¹ˆï¼Ÿä¹‹åå»éªŒè¯è‡ªå·±çŒœçš„æ˜¯å¦å‡†ç¡®ï¼Œè‡ªå·±æ˜¯å¦å’Œç¼–å†™ä»£ç çš„äººæƒ³æ³•æ˜¯å¦ä¸€è‡´ã€‚</p></blockquote> <p>ä»æ–¹æ³•çš„å®šä¹‰å’±ä»¬ç›²çŒœä¸€æ³¢ï¼Œæ–¹æ³•åå·²ç»è¯´æ˜è¯¥æ–¹æ³•ç”¨äºåŠ è½½ bean å®šä¹‰ä¿¡æ¯ï¼ŒåŠ è½½çš„ bean å®šä¹‰ä¿¡æ¯å­˜åœ¨å“ªå‘¢ï¼Ÿå½“ç„¶æ˜¯ä¼ å…¥çš„å‚æ•° <code>BeanFactory</code> çš„å®ä¾‹å¯¹è±¡ï¼Œåœ¨å‰é¢å·²ç»åˆ†æå‡º <strong><code>BeanFactory</code> ä½œä¸º bean å®šä¹‰ä¿¡æ¯çš„æ³¨å†Œä¸­å¿ƒ</strong>ï¼Œè™½ç„¶ <code>BeanFactory</code> è¿˜æœ‰å…¶ä»–çš„èƒ½åŠ›ï¼Œä½†æ˜¯åœ¨æœ¬ç¯‡æ–‡ç« ä¸­å®ƒçš„èƒ½åŠ›å°±æ˜¯ç®¡ç† bean å®šä¹‰ä¿¡æ¯ã€‚åœ¨å®ç°ç±» <code>DefaultListableBeanFactory</code> ä¸­å®šä¹‰äº†ä¸¤ä¸ªé›†åˆä¸“é—¨ç”¨æ¥ç®¡ç† bean å®šä¹‰ä¿¡æ¯ï¼Œæ‰€ä»¥å’±ä»¬éœ€è¦å°†å®ä¾‹åŒ–çš„ <code>BeanFactory</code> å¯¹è±¡ä¼ å…¥æ–¹æ³•ä¸­ï¼Œç­‰è§£æå®Œ XML é…ç½®æ–‡ä»¶åå°±å¯ä»¥å°†è§£æå‡ºæ¥çš„ bean å®šä¹‰ä¿¡æ¯ä¿å­˜èµ·æ¥ï¼Œç­‰åˆ°åç»­åˆ›å»º bean çš„å®ä¾‹å¯¹è±¡æ—¶æ‹¿å‡ºæ¥ä½¿ç”¨ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">DefaultListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token comment">// Create a new XmlBeanDefinitionReader for the given BeanFactory.</span>
    <span class="token comment">// åˆå§‹åŒ– XmlBeanDefinitionReader</span>
    <span class="token class-name">XmlBeanDefinitionReader</span> beanDefinitionReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlBeanDefinitionReader</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Configure the bean definition reader with this context's</span>
    <span class="token comment">// resource loading environment.</span>
    <span class="token comment">// é…ç½® XmlBeanDefinitionReader çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</span>
    beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEnvironment</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setResourceLoader</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    beanDefinitionReader<span class="token punctuation">.</span><span class="token function">setEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResourceEntityResolver</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Allow a subclass to provide custom initialization of the reader,</span>
    <span class="token comment">// then proceed with actually loading the bean definitions.</span>
    <span class="token comment">// ç•™ç»™å­ç±»å»è‡ªå®šä¹‰ XmlBeanDefinitionReader</span>
    <span class="token function">initBeanDefinitionReader</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å§”æ‰˜ beanDefinitionReader æ¥åŠ è½½ XML ä¸­çš„ BeanDefinition</span>
    <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>beanDefinitionReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­åˆ›å»ºå‡ºä¸€ä¸ª <code>XmlBeanDefinitionReader</code> å®ä¾‹å¯¹è±¡ï¼Œå°†å’±ä»¬åˆ›å»ºå‡ºæ¥çš„ <code>beanFactory</code> ä½œä¸ºå‚æ•°ä¼ å…¥æ„é€ æ–¹æ³•ä¸­ï¼Œåœ¨ <code>XmlBeanDefinitionReader</code> ç±»ä¸­è‚¯å®šä¼šå­˜åœ¨ä¸€ä¸ª <code>BeanDefinitionRegistry</code> æ¥å£çš„å±æ€§ç”¨äºä¿å­˜è¯¥å¯¹è±¡ï¼Œä¸ºä»€ä¹ˆæ˜¯ <code>BeanDefinitionRegistry</code> æ¥å£çš„å±æ€§ï¼Ÿç›¸ä¿¡åº”è¯¥ä¸ç”¨å†å•°å—¦äº†å§ï¼ä»ç±»åå°±å¯ä»¥çœ‹å‡ºè¯¥ç±»ä¸“é—¨ç”¨æ¥ä» XML é…ç½®æ–‡ä»¶è¯»å– bean å®šä¹‰ä¿¡æ¯ã€‚</p> <h4 id="_2-3-1-xmlbeandefinitionreader"><a href="#_2-3-1-xmlbeandefinitionreader" class="header-anchor">#</a> 2.3.1. XmlBeanDefinitionReader</h4> <p>åˆ›å»ºå‡º <code>XmlBeanDefinitionReader</code> å¯¹è±¡ä¹‹åï¼Œæ¥åˆ°é‡è½½æ–¹æ³•ä¸­ï¼Œåœ¨é‡è½½æ–¹æ³•ä¸­æœ€ç»ˆä¼šè°ƒç”¨ <code>XmlBeanDefinitionReader</code> ç±»ä¸­çš„ <code>loadBeanDefinitions()</code> æ–¹æ³•ï¼Œå°†å’±ä»¬çš„ Spring é…ç½®æ–‡ä»¶è·¯å¾„ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">XmlBeanDefinitionReader</span> reader<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>  
   <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configResources <span class="token operator">=</span> <span class="token function">getConfigResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>configResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configResources<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token comment">// è·å–å‰é¢å°è£…å¥½çš„ XML æ–‡ä»¶è·¯å¾„å¯¹åº”çš„ String æ•°ç»„  </span>
   <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> configLocations <span class="token operator">=</span> <span class="token function">getConfigLocations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>configLocations <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      reader<span class="token punctuation">.</span><span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>configLocations<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>åœ¨ <code>XmlBeanDefinitionReader</code> çš„çˆ¶ç±» <code>AbstractBeanDefinitionReader</code> ä¸­å­˜åœ¨è¯¥æ–¹æ³•çš„å¤šä¸ªé‡è½½æ–¹æ³•ï¼Œæœ€ç»ˆä¼šæ¥åˆ°ä¸‹é¢çš„é‡è½½æ–¹æ³•ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">String</span> location<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Resource</span><span class="token punctuation">&gt;</span></span> actualResources<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    <span class="token class-name">ResourceLoader</span> resourceLoader <span class="token operator">=</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
            <span class="token string">&quot;Cannot load bean definitions from location [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]: no ResourceLoader available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceLoader <span class="token keyword">instanceof</span> <span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Resource pattern matching available.</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resources <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">)</span> resourceLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>actualResources<span class="token punctuation">,</span> resources<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded &quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot; bean definitions from location pattern [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> count<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
                <span class="token string">&quot;Could not resolve bean definition resource pattern [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Can only load single resources by absolute URL.</span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>actualResources <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            actualResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded &quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot; bean definitions from location [&quot;</span> <span class="token operator">+</span> location <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè·å–ä¸€ä¸ª <code>ResourceLoader</code> å¯¹è±¡ï¼Œèµ„æºåŠ è½½å™¨ï¼Œç”¨äºåŠ è½½å¯¹åº”è·¯å¾„çš„èµ„æºã€‚<span style="background:#d3f8b6;">TODO</span> å…³äºèµ„æºåŠ è½½å™¨åœ¨åç»­ä¼šä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« åˆ†æï¼Œæ­¤å¤„ä¸åšè¯¦ç»†çš„æè¿°ï¼Œä¸ç„¶å¾ˆå®¹æ˜“è·‘é¢˜ã€‚é€šè¿‡èµ„æºåŠ è½½å™¨å°†ä¼ å…¥çš„ Spring é…ç½®æ–‡ä»¶è·¯å¾„è§£æä¹‹åå°è£…æˆä¸€ä¸ª <code>Resource</code> èµ„æºå¯¹è±¡ï¼Œç„¶åå°†èµ„æºå¯¹è±¡ä¼ å…¥åˆ°å¦ä¸€ä¸ªé‡è½½æ–¹æ³•ä¸­ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œå¦å¤–ä¸€ä¸ªé‡è½½æ–¹æ³•åœ¨çˆ¶ç±»ä¸­å¹¶æ²¡æœ‰è¢«å®ç°ï¼Œæ‰€ä»¥å…œå…œè½¬è½¬åˆå›åˆ°å­ç±» <code>XmlBeanDefinitionReader</code> ä¸­çš„ <code>loadBeanDefinitions(resource)</code> æ–¹æ³•ï¼Œç›¸ä¿¡æœ‰çš„å°ä¼™ä¼´çœ‹åˆ°è¿™ï¼Œéƒ½è¢« Spring ç»™å¼„ç³Šæ¶‚äº†ï¼Œä½†ä½ åˆä¸å¾—ä¸æœï¼ŒSpring æ•´ä¸ªæºç ä¸­çœŸæ˜¯å°† <strong>æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</strong> ä½¿ç”¨çš„æ˜¯æ·‹æ¼“å°½è‡´ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>  
   <span class="token comment">// å°† Resource å°è£…æˆ EncodedResource   </span>
   <span class="token keyword">return</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EncodedResource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">loadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">EncodedResource</span> encodedResource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>  
   <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">,</span> <span class="token string">&quot;EncodedResource must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Loading XML bean definitions from &quot;</span> <span class="token operator">+</span> encodedResource<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EncodedResource</span><span class="token punctuation">&gt;</span></span> currentResources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcesCurrentlyBeingLoaded<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentResources<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>  
            <span class="token string">&quot;Detected cyclic loading of &quot;</span> <span class="token operator">+</span> encodedResource <span class="token operator">+</span> <span class="token string">&quot; - check your import definitions!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token class-name">InputSource</span> inputSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputSource</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">if</span> <span class="token punctuation">(</span>encodedResource<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         inputSource<span class="token punctuation">.</span><span class="token function">setEncoding</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">.</span><span class="token function">getEncoding</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
      <span class="token keyword">return</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>  
            <span class="token string">&quot;IOException parsing XML document from &quot;</span> <span class="token operator">+</span> encodedResource<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">finally</span> <span class="token punctuation">{</span>  
      currentResources<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>encodedResource<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">if</span> <span class="token punctuation">(</span>currentResources<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         <span class="token keyword">this</span><span class="token punctuation">.</span>resourcesCurrentlyBeingLoaded<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><blockquote><p>æºç é˜…è¯»æŠ€å·§ï¼šåœ¨åˆ†æ Spring æºç æ—¶ï¼Œ<strong>éœ€è¦ç€é‡å…³æ³¨ try ä¸­çš„ä»£ç å’Œå¸¦ do å‰ç¼€çš„æ–¹æ³•</strong>ï¼Œå› ä¸ºæ­¤å¤„çš„ä»£ç æ˜¯çœŸæ­£å¹²å®äº‹çš„ä»£ç ã€‚</p></blockquote> <p>å°†èµ„æºè½¬å˜æˆè¾“å…¥æµä¹‹åä¼ å…¥ <code>doLoadBeanDefinitions()</code> æ–¹æ³•ä¸­ï¼Œåˆ†æäº†åŠå¤©ï¼Œå‰æˆåšè¶³ï¼Œç»ˆäºçœ‹åˆ°çœŸæ­£åŠ è½½ bean å®šä¹‰ä¿¡æ¯çš„æ–¹æ³•ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">doLoadBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">InputSource</span> inputSource<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Document</span> doc <span class="token operator">=</span> <span class="token function">doLoadDocument</span><span class="token punctuation">(</span>inputSource<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded &quot;</span> <span class="token operator">+</span> count <span class="token operator">+</span> <span class="token string">&quot; bean definitions from &quot;</span> <span class="token operator">+</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå°† Spring é…ç½®æ–‡ä»¶çš„è¾“å…¥æµè½¬åŒ–æˆ <code>Document</code> å¯¹è±¡ï¼Œä¸ç”¨è¯´ï¼Œæ¥ä¸‹æ¥è‚¯å®šæ˜¯è§£æ XML é…ç½®æ–‡ä»¶å¹¶æ³¨å†Œ bean å®šä¹‰ä¿¡æ¯ï¼ŒåºŸè¯ï¼Œè¿™å°±æ˜¯ä»Šå¤©çš„ä¸»é¢˜ï¼</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeanDefinitionStoreException</span> <span class="token punctuation">{</span>  
   <span class="token class-name">BeanDefinitionDocumentReader</span> documentReader <span class="token operator">=</span> <span class="token function">createBeanDefinitionDocumentReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">int</span> countBefore <span class="token operator">=</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   documentReader<span class="token punctuation">.</span><span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span> <span class="token function">createReaderContext</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">return</span> <span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinitionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> countBefore<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">XmlReaderContext</span> <span class="token function">createReaderContext</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> resource<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">XmlReaderContext</span><span class="token punctuation">(</span>resource<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>problemReporter<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>eventListener<span class="token punctuation">,</span>  
         <span class="token keyword">this</span><span class="token punctuation">.</span>sourceExtractor<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token function">getNamespaceHandlerResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">NamespaceHandlerResolver</span> <span class="token function">getNamespaceHandlerResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>namespaceHandlerResolver <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span>namespaceHandlerResolver <span class="token operator">=</span> <span class="token function">createDefaultNamespaceHandlerResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>namespaceHandlerResolver<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  
  
<span class="token keyword">protected</span> <span class="token class-name">NamespaceHandlerResolver</span> <span class="token function">createDefaultNamespaceHandlerResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token class-name">ClassLoader</span> cl <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">getResourceLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultNamespaceHandlerResolver</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_2-3-2-beandefinitiondocumentreader"><a href="#_2-3-2-beandefinitiondocumentreader" class="header-anchor">#</a> 2.3.2. BeanDefinitionDocumentReader</h4> <p>åœ¨è¯¥æ–¹æ³•ä¸­åˆåˆ›å»ºä¸€ä¸ª <code>BeanDefinitionDocumentReader</code> å¯¹è±¡ï¼Œå°† <code>document</code> ä»¥åŠ <code>XmlBeanDefinitionReader</code> çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸€å¹¶ä¼ å…¥åˆ° <code>BeanDefinitionDocumentReader</code> ç±»ä¸­çš„ <code>registerBeanDefinitions()</code> æ–¹æ³•ï¼Œåœ¨ä¸Šä¸‹æ–‡ä¿¡æ¯ä¸­å­˜åœ¨ä¸€ä¸ª <code>NamespaceHandlerResolver</code> ç±»å‹çš„å®ä¾‹å¯¹è±¡ï¼Œè¯¥å®ä¾‹å¯¹è±¡åœ¨åé¢è§£æè‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ çš„æ—¶å€™ä¼šè¢«ä½¿ç”¨åˆ°ï¼Œç°åœ¨å…ˆæä¸€å˜´ã€‚æœ‰çš„å°ä¼™ä¼´å¯èƒ½å°±å¾ˆç–‘æƒ‘ï¼ŒSpring è¿™æ ·ä¼ æ¥ä¼ å»åˆ°åº•æ˜¯åœ¨å¹²ä»€ä¹ˆï¼Ÿå…¶å® Spring å°†æ¯ä¸ªç±»çš„èŒè´£åˆ†çš„å¾ˆæ¸…æ¥šï¼Œç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œä¸“äººåšä¸“äº‹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Document</span> doc<span class="token punctuation">,</span> <span class="token class-name">XmlReaderContext</span> readerContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext <span class="token operator">=</span> readerContext<span class="token punctuation">;</span>
    <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span>doc<span class="token punctuation">.</span><span class="token function">getDocumentElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Any nested &lt;beans&gt; elements will cause recursion in this method. In</span>
    <span class="token comment">// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,</span>
    <span class="token comment">// keep track of the current (parent) delegate, which may be null. Create</span>
    <span class="token comment">// the new (child) delegate with a reference to the parent for fallback purposes,</span>
    <span class="token comment">// then ultimately reset this.delegate back to its original (parent) reference.</span>
    <span class="token comment">// this behavior emulates a stack of delegates without actually necessitating one.</span>
    <span class="token class-name">BeanDefinitionParserDelegate</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token function">createDelegate</span><span class="token punctuation">(</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> root<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> profileSpec <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">PROFILE_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>profileSpec<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> specifiedProfiles <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span>
                profileSpec<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span><span class="token punctuation">.</span><span class="token constant">MULTI_VALUE_ATTRIBUTE_DELIMITERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// We cannot use Profiles.of(...) since profile expressions are not supported</span>
            <span class="token comment">// in XML config. See SPR-12458 for details.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acceptsProfiles</span><span class="token punctuation">(</span>specifiedProfiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Skipped XML bean definition file due to specified profiles [&quot;</span> <span class="token operator">+</span> profileSpec <span class="token operator">+</span>
                                 <span class="token string">&quot;] not matching: &quot;</span> <span class="token operator">+</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">preProcessXml</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// å§”æ´¾æ¨¡å¼ï¼Œè§£ææ‰€æœ‰çš„beanå®šä¹‰ä¿¡æ¯</span>
    <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">postProcessXml</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>delegate <span class="token operator">=</span> parent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h4 id="_2-3-3-beandefinitionparserdelegate"><a href="#_2-3-3-beandefinitionparserdelegate" class="header-anchor">#</a> 2.3.3. BeanDefinitionParserDelegate</h4> <p>åœ¨è¯¥æ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ª <code>BeanDefinitionParserDelegate</code> å¯¹è±¡ï¼Œå°†å½“å‰ root æ ‡ç­¾å…ƒç´ ä»¥åŠä¸Šä¸‹æ–‡ä¿¡æ¯å½“ä½œå‚æ•°ä¼ å…¥åˆ°æ„é€ æ–¹æ³•ä¸­ã€‚çœ‹åå­—ä¸éš¾çŸ¥é“ï¼Œbean å®šä¹‰ä¿¡æ¯è§£æå§”æ‰˜ç±»ï¼Œä¸“é—¨ç”¨æ¥è§£æ XML ä¸­çš„ <code>bean</code> æ ‡ç­¾å…ƒç´ ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">parseBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">Element</span> root<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token comment">// åˆ¤æ–­å½“å‰å…ƒç´ æ˜¯å¦æ˜¯é»˜è®¤æ ‡ç­¾  </span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token class-name">NodeList</span> nl <span class="token operator">=</span> root<span class="token punctuation">.</span><span class="token function">getChildNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nl<span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         <span class="token class-name">Node</span> node <span class="token operator">=</span> nl<span class="token punctuation">.</span><span class="token function">item</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>  
         <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token keyword">instanceof</span> <span class="token class-name">Element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token class-name">Element</span> ele <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Element</span><span class="token punctuation">)</span> node<span class="token punctuation">;</span>  
            <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">isDefaultNamespace</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
               <span class="token comment">// è§£æé»˜è®¤æ ‡ç­¾å…ƒç´ ï¼ˆimportã€beanã€aliasã€beansæ ‡ç­¾ï¼‰  </span>
               <span class="token function">parseDefaultElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">else</span> <span class="token punctuation">{</span>  
               <span class="token comment">// è§£æè‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ ï¼Œä¾‹å¦‚å¼€å¯ AOP åŠŸèƒ½çš„æ ‡ç­¾ï¼šaop:aspectj-autoproxyï¼Œcontext:component-scan  </span>
               delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
         <span class="token punctuation">}</span>  
      <span class="token punctuation">}</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">else</span> <span class="token punctuation">{</span>  
      <span class="token comment">// è§£æè‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ ï¼Œä¾‹å¦‚å¼€å¯ AOP åŠŸèƒ½çš„æ ‡ç­¾ï¼šaop:aspectj-autoproxyï¼Œcontext:component-scan  </span>
      delegate<span class="token punctuation">.</span><span class="token function">parseCustomElement</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šåˆ¤æ–­å½“å‰ root å…ƒç´ æ˜¯å¦æ˜¯é»˜è®¤æ ‡ç­¾å…ƒç´ ï¼Œå³è¯¥æ ‡ç­¾å…ƒç´ çš„ <code>namespaceURI</code> æ˜¯å¦ç­‰äº &quot;http://www.springframework.org/schema/beans&quot; ã€‚<br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220925030240.png" loading="lazy" class="lazy"><br>
é€šè¿‡æ‰“æ–­ç‚¹å¯ä»¥çŸ¥é“å½“å‰ root å…ƒç´ æ˜¯ beans æ ‡ç­¾å…ƒç´ ï¼Œå®ƒçš„ <code>namespaceURI</code> = &quot;http://www.springframework.org/schema/beans&quot; ï¼Œæ‰€ä»¥æ»¡è¶³æ¡ä»¶ï¼Œè¿›å…¥ if ä¸­ï¼Œè·å–è¯¥ beans æ ‡ç­¾ä¸­æ‰€æœ‰çš„å­æ ‡ç­¾å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å’±ä»¬å®šä¹‰åœ¨ XML é…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰æ ‡ç­¾å…ƒç´ ã€‚å¾ªç¯éå†æ¯ä¸ªæ ‡ç­¾å…ƒç´ ï¼ŒæŒ¨ä¸ªåˆ¤æ–­æ¯ä¸ªæ ‡ç­¾æ˜¯é»˜è®¤æ ‡ç­¾å…ƒç´ è¿˜æ˜¯è‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ ï¼Œå¦‚æœæ˜¯ <strong>é»˜è®¤æ ‡ç­¾å…ƒç´ ï¼Œå¦‚ <code>import</code>ã€<code>bean</code>ã€<code>alias</code>ã€<code>beans</code> æ ‡ç­¾</strong>ï¼Œåˆ™èµ°é»˜è®¤æ ‡ç­¾è§£ææµç¨‹ï¼›å¦‚æœæ˜¯ <strong>è‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ ï¼Œå¦‚ <code>context:component-scan</code>ã€<code>aop:aspectj-autoproxy</code> ç­‰æ ‡ç­¾</strong>ï¼Œåˆ™èµ°è‡ªå®šä¹‰æ ‡ç­¾è§£ææµç¨‹ã€‚</p> <h5 id="_2-3-3-1-é»˜è®¤æ ‡ç­¾è§£æ"><a href="#_2-3-3-1-é»˜è®¤æ ‡ç­¾è§£æ" class="header-anchor">#</a> 2.3.3.1. é»˜è®¤æ ‡ç­¾è§£æ</h5> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseDefaultElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">IMPORT_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">importBeanDefinitionResource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">ALIAS_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">processAliasRegistration</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">BEAN_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">processBeanDefinition</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> delegate<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>delegate<span class="token punctuation">.</span><span class="token function">nodeNameEquals</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">NESTED_BEANS_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token comment">// recurse  </span>
      <span class="token function">doRegisterBeanDefinitions</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä¼šä¾æ¬¡æ ¹æ®å½“å‰æ ‡ç­¾å…ƒç´ çš„åç§°åˆ¤æ–­æ˜¯ 4 ç§é»˜è®¤æ ‡ç­¾å…ƒç´ ä¸­çš„å“ªä¸€ä¸ªï¼Œæœ€å€¼å¾—å’±ä»¬å…³æ³¨çš„æ˜¯ bean æ ‡ç­¾å…ƒç´ ï¼Œå› ä¸ºå’±ä»¬ä»Šå¤©çš„ä¸»é¢˜å°±æ˜¯è§£æ XML é…ç½®æ–‡ä»¶åŠ è½½ bean å®šä¹‰ä¿¡æ¯ï¼Œè¿™é‡Œæ­£æ˜¯å°† bean æ ‡ç­¾è§£ææˆ bean å®šä¹‰ä¿¡æ¯çš„åœ°æ–¹ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">processBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionParserDelegate</span> delegate<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token class-name">BeanDefinitionHolder</span> bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>bdHolder <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      bdHolder <span class="token operator">=</span> delegate<span class="token punctuation">.</span><span class="token function">decorateBeanDefinitionIfRequired</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bdHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">try</span> <span class="token punctuation">{</span>  
         <span class="token comment">// Register the final decorated instance.  </span>
         <span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>bdHolder<span class="token punctuation">,</span> <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionStoreException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to register bean definition with name '&quot;</span> <span class="token operator">+</span>  
               bdHolder<span class="token punctuation">.</span><span class="token function">getBeanName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;'&quot;</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
      <span class="token comment">// Send registration event.  </span>
      <span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fireComponentRegistered</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanComponentDefinition</span><span class="token punctuation">(</span>bdHolder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œä½¿ç”¨ bean å®šä¹‰ä¿¡æ¯è§£æå§”æ‰˜ç±»çš„ <code>parseBeanDefinitionElement(ele)</code> æ–¹æ³•è§£æå½“å‰ bean æ ‡ç­¾å…ƒç´ ï¼Œè§£æå®Œæˆä¹‹åè¿”å›ä¸€ä¸ª bean å®šä¹‰ä¿¡æ¯çš„åŒ…è£…ç±»ï¼Œæœ€åä½¿ç”¨ <code>BeanDefinitionReaderUtils</code> å·¥å…·ç±»çš„ <code>registerBeanDefinition()</code> æ–¹æ³•æ³¨å†Œ bean å®šä¹‰ä¿¡æ¯ï¼Œå·¥å…·ç±»çš„ <code>registerBeanDefinition()</code> æ–¹æ³•è‚¯å®šéœ€è¦ä¸€ä¸ª <code>BeanDefinition</code> ä»¥åŠä¸€ä¸ª bean å®šä¹‰ä¿¡æ¯çš„æ³¨å†Œä¸­å¿ƒï¼Œç»†æƒ³ä¸€ä¸‹ï¼Œåªæœ‰å°†è¿™ä¸¤ä¸ªå‚æ•°ä¼ å…¥ï¼Œæ‰èƒ½å®Œæˆæ³¨å†Œ bean å®šä¹‰ä¿¡æ¯çš„åŠŸèƒ½ï¼Œä¸æ˜¯å—ï¼Ÿç°åœ¨é‡ç‚¹è½åœ¨ bean æ ‡ç­¾å…ƒç´ æ˜¯å¦‚ä½•è§£ææˆ bean å®šä¹‰ä¿¡æ¯çš„ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BeanDefinitionHolder</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">BeanDefinitionHolder</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinition</span> containingBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> id <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">ID_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> nameAttr <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">NAME_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> aliases <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>nameAttr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nameArr <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span>nameAttr<span class="token punctuation">,</span> <span class="token constant">MULTI_VALUE_ATTRIBUTE_DELIMITERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aliases<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>nameArr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">String</span> beanName <span class="token operator">=</span> id<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>aliases<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beanName <span class="token operator">=</span> aliases<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;No XML 'id' specified - using '&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span>
                         <span class="token string">&quot;' as bean name and &quot;</span> <span class="token operator">+</span> aliases <span class="token operator">+</span> <span class="token string">&quot; as aliases&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>containingBean <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">checkNameUniqueness</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> aliases<span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">AbstractBeanDefinition</span> beanDefinition <span class="token operator">=</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> containingBean<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanDefinition <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>containingBean <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    beanName <span class="token operator">=</span> <span class="token class-name">BeanDefinitionReaderUtils</span><span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>
                        beanDefinition<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    beanName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Register an alias for the plain bean class name, if still possible,</span>
                    <span class="token comment">// if the generator returned the class name plus a suffix.</span>
                    <span class="token comment">// This is expected for Spring 1.2/2.0 backwards compatibility.</span>
                    <span class="token class-name">String</span> beanClassName <span class="token operator">=</span> beanDefinition<span class="token punctuation">.</span><span class="token function">getBeanClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>beanClassName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
                        beanName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> beanName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> beanClassName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                        <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isBeanNameInUse</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        aliases<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>beanClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Neither XML 'id' nor 'name' specified - &quot;</span> <span class="token operator">+</span>
                                 <span class="token string">&quot;using generated bean name [&quot;</span> <span class="token operator">+</span> beanName <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aliasesArray <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>aliases<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">(</span>beanDefinition<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> aliasesArray<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆæ‹¿åˆ° bean æ ‡ç­¾ä¸­ä¸¤ä¸ªçš„å±æ€§ id ä¸ classï¼Œç”¨äºåˆ†æå½“å‰ bean å®šä¹‰ä¿¡æ¯çš„åç§°åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¹‹åè°ƒç”¨å¦ä¸€ä¸ªé‡è½½æ–¹æ³• <code>parseBeanDefinitionElement(ele, beanName, containingBean)</code>ï¼Œç›²çŒœä¸€æ³¢ï¼Œè‚¯å®šä¼šåˆ›å»ºå‡ºä¸€ä¸ª <code>BeanDefinition</code> çš„å®ä¾‹å¯¹è±¡ï¼Œç„¶åç»™å®ä¾‹å¯¹è±¡ä¸­çš„å„ä¸ªå±æ€§èµ‹å€¼ï¼Œè®©å’±ä»¬æ¥çœ‹çœ‹æ˜¯ä¸æ˜¯å‘¢ï¼Ÿ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">AbstractBeanDefinition</span> <span class="token function">parseBeanDefinitionElement</span><span class="token punctuation">(</span>
			<span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinition</span> containingBean<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>parseState<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanEntry</span><span class="token punctuation">(</span>beanName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ele<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">CLASS_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        className <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">CLASS_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">String</span> parent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ele<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">PARENT_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent <span class="token operator">=</span> ele<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">PARENT_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">AbstractBeanDefinition</span> bd <span class="token operator">=</span> <span class="token function">createBeanDefinition</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">parseBeanDefinitionAttributes</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> beanName<span class="token punctuation">,</span> containingBean<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bd<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token class-name">DomUtils</span><span class="token punctuation">.</span><span class="token function">getChildElementValueByTagName</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token constant">DESCRIPTION_ELEMENT</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//ä»¥ä¸‹æ˜¯è§£æBeanæ ‡ç­¾é‡Œé¢çš„å…ƒæ•°æ®ï¼Œå¹¶å¡«å……BeanDefinition</span>
        <span class="token function">parseMetaElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">parseLookupOverrideSubElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">.</span><span class="token function">getMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">parseReplacedMethodSubElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">.</span><span class="token function">getMethodOverrides</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">parseConstructorArgElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">parsePropertyElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">parseQualifierElements</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> bd<span class="token punctuation">)</span><span class="token punctuation">;</span>

        bd<span class="token punctuation">.</span><span class="token function">setResource</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bd<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span><span class="token function">extractSource</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> bd<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Bean class [&quot;</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">&quot;] not found&quot;</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoClassDefFoundError</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Class that bean class [&quot;</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">&quot;] depends on not found&quot;</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected failure during bean definition parsing&quot;</span><span class="token punctuation">,</span> ele<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>parseState<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>çœ‹äººçœŸå‡†ï¼åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè·å– <code>bean</code> æ ‡ç­¾ä¸­çš„ class å±æ€§ï¼Œè°ƒç”¨ <code>createBeanDefinition()</code> æ–¹æ³•åˆ›å»º <code>BeanDefinition</code> å®ä¾‹å¯¹è±¡ï¼Œä¹‹åå°±æ˜¯è§£æ bean æ ‡ç­¾ä¸­çš„å„ç§å±æ€§å’Œ <code>bean</code> æ ‡ç­¾çš„å­æ ‡ç­¾ï¼Œå¦‚ <code>property</code> å’Œ <code>constructor-arg</code> æ ‡ç­¾ï¼Œè§£æå®Œæˆä¹‹åå°±ä¼šå¡«å……åˆ° <code>BeanDefinition</code> å®ä¾‹å¯¹è±¡ä¸­ç›¸å¯¹åº”çš„å±æ€§ä¸Šï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥è‡ªå·±åˆ†æä¸€æ³¢ï¼Œå’±ä»¬æ˜ç™½ bean æ ‡ç­¾å…ƒç´ æ˜¯å¦‚ä½•è¢«è§£ææˆ <code>BeanDefinition</code> å¯¹è±¡çš„åŸç†å³å¯ã€‚<br>
è‡³æ­¤ï¼Œbean å®šä¹‰ä¿¡æ¯çš„è§£æä¸æ³¨å†Œæµç¨‹å°±å·²ç»åˆ†æå®Œæ¯•ï¼å¯¹æ­¤ï¼Œè¿˜ä¸æ¸…æ¥šçš„å°ä¼™ä¼´ï¼Œå¯ä»¥è‡ªå·±æ‰“æ–­ç‚¹çš„åŒæ—¶å†æ ¹æ®è¯¥æ–‡ç« é€æ­¥é€æ­¥èµ°å‡ éæµç¨‹ï¼Œè‡ªç„¶å°±å¾ˆæ¸…æ¥šäº†ï¼</p> <blockquote><p>æºç é˜…è¯»æŠ€å·§ï¼šæ­å»ºå¼€å‘è°ƒè¯•ç¯å¢ƒï¼Œç¼–å†™ Demo ç¤ºä¾‹ï¼Œç„¶åé€šè¿‡ <strong>æ‰“æ–­ç‚¹ DEBUG</strong> çš„æ–¹å¼ï¼Œç»“åˆè¿è¡Œæ—¶æ•°æ®ï¼Œæ–¹ä¾¿å¯¹ä»£ç çš„ç†è§£ã€‚</p></blockquote> <h5 id="_2-3-3-2-è‡ªå®šä¹‰æ ‡ç­¾è§£æ"><a href="#_2-3-3-2-è‡ªå®šä¹‰æ ‡ç­¾è§£æ" class="header-anchor">#</a> 2.3.3.2. è‡ªå®šä¹‰æ ‡ç­¾è§£æ</h5> <p>å¦‚æœå½“å‰æ ‡ç­¾å…ƒç´ ä¸å±äºé»˜è®¤æ ‡ç­¾å…ƒç´ ä¸­çš„ä»»ä½•ä¸€ç§ï¼Œåˆ™ç›´æ¥è°ƒç”¨ <code>BeanDefinitionParserDelegate</code> ç±»ä¸­çš„ <code>parseCustomElement(ele)</code> æ–¹æ³•ï¼Œè§£æå½“å‰æ ‡ç­¾å…ƒç´ ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span> <span class="token function">parseCustomElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// è§£æè‡ªå®šä¹‰æ ‡ç­¾å…ƒç´ ï¼Œä¾‹å¦‚å¼€å¯ AOP åŠŸèƒ½çš„ï¼šaop:aspectj-autoproxyï¼ŒåŒ…æ‰«æåŠŸèƒ½çš„:context:component-scan</span>
    <span class="token keyword">return</span> <span class="token function">parseCustomElement</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span> <span class="token function">parseCustomElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> ele<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">BeanDefinition</span> containingBd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
	 * è·å–æ ‡ç­¾å…ƒç´ çš„å‘½åç©ºé—´ URIï¼Œ
	 * ä¾‹å¦‚:
	 * AOP çš„å‘½åç©ºé—´ URI ä¸ºï¼š&quot;http://www.springframework.org/schema/aop&quot;
	 * äº‹åŠ¡ çš„å‘½åç©ºé—´ URI ä¸ºï¼š&quot;http://www.springframework.org/schema/tx&quot;
	 * åŒ…æ‰«æçš„å‘½åç©ºé—´ URI ä¸ºï¼š&quot;http://www.springframework.org/schema/context&quot;
	 */</span>
    <span class="token class-name">String</span> namespaceUri <span class="token operator">=</span> <span class="token function">getNamespaceURI</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>namespaceUri <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åŸºäº META-INFO/spring.handlers é…ç½®æ–‡ä»¶ï¼Œè·å–å‘½åç©ºé—´ uri å¯¹åº”çš„å‘½åç©ºé—´å¤„ç†å™¨</span>
    <span class="token class-name">NamespaceHandler</span> handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">.</span><span class="token function">getNamespaceHandlerResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>namespaceUri<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to locate Spring NamespaceHandler for XML schema namespace [&quot;</span> <span class="token operator">+</span> namespaceUri <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ele<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è§£ææ ‡ç­¾å…ƒç´ </span>
    <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>ele<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ParserContext</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readerContext<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> containingBd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>å’±ä»¬åœ¨è¯¥æ–¹æ³•ä¸­æ‰“ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹ä¸‹å½“å‰å½“å‰æ ‡ç­¾å…ƒç´ æ˜¯ä¸æ˜¯å’±ä»¬åœ¨ XML é…ç½®æ–‡ä»¶ä¹¦å†™çš„ <code>context:component-scan</code> æ ‡ç­¾å…ƒç´ ã€‚å’±ä»¬å°±ä»¥ <code>context:component-scan</code> æ ‡ç­¾å…ƒç´ ä¸ºä¾‹ï¼Œå…¶ä»–è‡ªå®šä¹‰æ ‡ç­¾çš„è§£ææµç¨‹éƒ½ä¸ä¹‹ç±»ä¼¼ï¼Œä¸€æ³•é€šä¸‡æ³•é€šã€‚<br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220925052007.png" loading="lazy" class="lazy"><br>
ç°åœ¨å·²ç»çŸ¥é“å½“å‰æ ‡ç­¾å…ƒç´ æ˜¯ <code>context:component-scan</code>ï¼Œé‚£ä¹ˆæ€ä¹ˆè§£æè¯¥æ ‡ç­¾å…ƒç´ å‘¢ï¼Ÿ</p> <h6 id="_2-3-3-2-1-namespacehandlerresolver"><a href="#_2-3-3-2-1-namespacehandlerresolver" class="header-anchor">#</a> 2.3.3.2.1. NamespaceHandlerResolver</h6> <p>ç»†å¿ƒçš„å°ä¼™ä¼´å¯èƒ½å·²ç»çŸ¥é“ <code>this.readerContext.getNamespaceHandlerResolver()</code> è·å–å‡ºæ¥çš„å¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ï¼Œåœ¨å‰é¢å’±ä»¬æè¿‡ä¸€å˜´ï¼Œä¸è¿‡ä¸çŸ¥é“çš„å°ä¼™ä¼´ä¸ç”¨æ…Œï¼Œå’±ä»¬è¿˜æœ‰ç»æ‹›ï¼Œåœ¨ DEBUG çš„æ—¶å€™é€‰ä¸­è¯¥ä»£ç ä½¿ç”¨ <code>CTRL+U</code> è®¡ç®—ä¸€ä¸‹ç»“æœã€‚<br> <img alt="|950" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220925054010.png" loading="lazy" class="lazy"><br>
ä»ä¸Šå›¾å¯ä»¥çŸ¥é“ï¼Œå½“å‰ <code>NamespaceHandlerResolver</code> æ¥å£çš„å®ä¾‹å¯¹è±¡ç±»å‹ä¸ºå…¶é»˜è®¤çš„å®ç°ç±» <code>DefaultNamespaceHandlerResolver</code> ç±»å‹ã€‚ç°åœ¨è°ƒç”¨ <code>DefaultNamespaceHandlerResolver</code> ä¸­çš„ <code>resolve()</code> æ–¹æ³•ï¼Œæ‰¾åˆ°ä¸å½“å‰ <code>namespaceURI</code> = &quot;http://www.springframework.org/schema/contex&quot; åŒ¹é…çš„ <code>NamespaceHandler</code> å¤„ç†å™¨ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">NamespaceHandler</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">String</span> namespaceUri<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> handlerMappings <span class="token operator">=</span> <span class="token function">getHandlerMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token class-name">Object</span> handlerOrClassName <span class="token operator">=</span> handlerMappings<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>namespaceUri<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>handlerOrClassName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>handlerOrClassName <span class="token keyword">instanceof</span> <span class="token class-name">NamespaceHandler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">NamespaceHandler</span><span class="token punctuation">)</span> handlerOrClassName<span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">else</span> <span class="token punctuation">{</span>  
      <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> handlerOrClassName<span class="token punctuation">;</span>  
      <span class="token keyword">try</span> <span class="token punctuation">{</span>  
         <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> handlerClass <span class="token operator">=</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>  
         <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">NamespaceHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>handlerClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FatalBeanException</span><span class="token punctuation">(</span><span class="token string">&quot;Class [&quot;</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">&quot;] for namespace [&quot;</span> <span class="token operator">+</span> namespaceUri <span class="token operator">+</span>  
                  <span class="token string">&quot;] does not implement the [&quot;</span> <span class="token operator">+</span> <span class="token class-name">NamespaceHandler</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;] interface&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
         <span class="token punctuation">}</span>  
         <span class="token class-name">NamespaceHandler</span> namespaceHandler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">NamespaceHandler</span><span class="token punctuation">)</span> <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">instantiateClass</span><span class="token punctuation">(</span>handlerClass<span class="token punctuation">)</span><span class="token punctuation">;</span>  
         namespaceHandler<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
         handlerMappings<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>namespaceUri<span class="token punctuation">,</span> namespaceHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>  
         <span class="token keyword">return</span> namespaceHandler<span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FatalBeanException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not find NamespaceHandler class [&quot;</span> <span class="token operator">+</span> className <span class="token operator">+</span>  
               <span class="token string">&quot;] for namespace [&quot;</span> <span class="token operator">+</span> namespaceUri <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
      <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">LinkageError</span> err<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">FatalBeanException</span><span class="token punctuation">(</span><span class="token string">&quot;Unresolvable class definition for NamespaceHandler class [&quot;</span> <span class="token operator">+</span>  
               className <span class="token operator">+</span> <span class="token string">&quot;] for namespace [&quot;</span> <span class="token operator">+</span> namespaceUri <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆä¼šè·å–æ‰€æœ‰å‘½åç©ºé—´ URI ä¸å‘½åç©ºé—´å¤„ç†å™¨çš„æ˜ å°„å…³ç³»ï¼Œç”¨ä¸€ä¸ª Map é›†åˆå­˜èµ·æ¥ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getHandlerMappings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> handlerMappings <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings<span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>handlerMappings <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         handlerMappings <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings<span class="token punctuation">;</span>  
         <span class="token keyword">if</span> <span class="token punctuation">(</span>handlerMappings <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
            <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
               logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Loading NamespaceHandler mappings from [&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappingsLocation <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">try</span> <span class="token punctuation">{</span>  
               <span class="token class-name">Properties</span> mappings <span class="token operator">=</span>  
                     <span class="token class-name">PropertiesLoaderUtils</span><span class="token punctuation">.</span><span class="token function">loadAllProperties</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappingsLocation<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>  
               <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
                  logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Loaded NamespaceHandler mappings: &quot;</span> <span class="token operator">+</span> mappings<span class="token punctuation">)</span><span class="token punctuation">;</span>  
               <span class="token punctuation">}</span>  
               handlerMappings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>mappings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
               <span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">mergePropertiesIntoMap</span><span class="token punctuation">(</span>mappings<span class="token punctuation">,</span> handlerMappings<span class="token punctuation">)</span><span class="token punctuation">;</span>  
               <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappings <span class="token operator">=</span> handlerMappings<span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
               <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>  
                     <span class="token string">&quot;Unable to load NamespaceHandler mappings from location [&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>handlerMappingsLocation <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>  
            <span class="token punctuation">}</span>  
         <span class="token punctuation">}</span>  
      <span class="token punctuation">}</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">return</span> handlerMappings<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ä½¿ç”¨ <code>PropertiesLoaderUtils</code> å·¥å…·ç±»ä¸­çš„ <code>loadAllProperties()</code> æ–¹æ³• <strong>åŠ è½½æ‰€æœ‰ <code>META-INF</code> ç›®å½•ä¸‹çš„ <code>spring.handlers</code> é…ç½®æ–‡ä»¶ï¼Œå»ºç«‹å‘½åç©ºé—´ URI ä¸å‘½åç©ºé—´å¤„ç†å™¨çš„æ˜ å°„å…³ç³»</strong>ã€‚<br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220926162436.png" loading="lazy" class="lazy"><br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220926162540.png" loading="lazy" class="lazy"></p> <h6 id="_2-3-3-2-2-namespacehandler"><a href="#_2-3-3-2-2-namespacehandler" class="header-anchor">#</a> 2.3.3.2.2. NamespaceHandler</h6> <p>å‘½åç©ºé—´ URI ä¸å‘½åç©ºé—´å¤„ç†å™¨çš„æ˜ å°„å…³ç³»å»ºç«‹å®Œæˆä¹‹åï¼Œéå¸¸å®¹æ˜“åœ°å°±å¯ä»¥æ‰¾åˆ°å½“å‰å‘½åç©ºé—´ URI æ‰€å¯¹åº”çš„å‘½åç©ºé—´å¤„ç†å™¨ï¼Œä»¥å½“å‰æµ‹è¯•æ¡ˆä¾‹æ¥è¯´ï¼Œè·å–å‡ºæ¥çš„å‘½åç©ºé—´å¤„ç†å™¨ç±»çš„å…¨é™å®šåä¸º <code>org.springframework.context.config.ContextNamespaceHandler</code>ï¼Œä¹‹åæ ¹æ®å…¨é™å®šååå°„åˆ›å»ºå‡º <code>ContextNamespaceHandler</code> çš„å®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨ <code>ContextNamespaceHandler</code> çš„ <code>init()</code> æ–¹æ³•ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ContextNamespaceHandler</span> <span class="token keyword">extends</span> <span class="token class-name">NamespaceHandlerSupport</span> <span class="token punctuation">{</span>  
  
   <span class="token annotation punctuation">@Override</span>  
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;property-placeholder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PropertyPlaceholderBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;property-override&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PropertyOverrideBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;annotation-config&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;component-scan&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ComponentScanBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;load-time-weaver&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">LoadTimeWeaverBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;spring-configured&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SpringConfiguredBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;mbean-export&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MBeanExportBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token function">registerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token string">&quot;mbean-server&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">MBeanServerBeanDefinitionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>å¯ä»¥å‘ç° <code>ContextNamespaceHandler</code> ç»§æ‰¿è‡ª <code>NamespaceHandlerSupport</code> ç±»ï¼Œåœ¨ <code>ContextNamespaceHandler</code> çš„ <code>init()</code> æ–¹æ³•ä¸­åˆå»ºç«‹èµ·äº†è‡ªå®šä¹‰æ ‡ç­¾ä¸ bean å®šä¹‰ä¿¡æ¯è§£æå™¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œä¿å­˜åœ¨çˆ¶ç±» <code>NamespaceHandlerSupport</code> çš„ <code>parsers</code> å±æ€§ä¸­ã€‚å¯ä»¥å‘ç° <strong><code>context:component-scan</code> æ ‡ç­¾å¯¹åº”çš„ bean å®šä¹‰ä¿¡æ¯è§£æå™¨ä¸º <code>ComponentScanBeanDefinitionParser</code></strong>ï¼Œåç»­åœ¨è§£æ <code>context:component-scan</code> æ ‡ç­¾æ—¶è‚¯å®šæ˜¯ç”¨ <code>ComponentScanBeanDefinitionParser</code> æ¥è§£æã€‚<br>
å›åˆ° <code>parseCustomElement()</code> æ–¹æ³•ï¼Œç°åœ¨å·²ç»çŸ¥é“è·å–å‡ºæ¥çš„ <code>NamespaceHandler</code> ä¸º <code>ContextNamespaceHandler</code> ç±»å‹çš„å®ä¾‹å¯¹è±¡ï¼Œç´§æ¥ç€è°ƒç”¨ <code>ContextNamespaceHandler</code> ä¸­çš„ <code>parse()</code> æ–¹æ³•æ¥è§£æå½“å‰æ ‡ç­¾å…ƒç´ ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">,</span> <span class="token class-name">ParserContext</span> parserContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token class-name">BeanDefinitionParser</span> parser <span class="token operator">=</span> <span class="token function">findParserForElement</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> parserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">return</span> <span class="token punctuation">(</span>parser <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> parserContext<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">BeanDefinitionParser</span> <span class="token function">findParserForElement</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">,</span> <span class="token class-name">ParserContext</span> parserContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token class-name">String</span> localName <span class="token operator">=</span> parserContext<span class="token punctuation">.</span><span class="token function">getDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLocalName</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token class-name">BeanDefinitionParser</span> parser <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parsers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>localName<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>parser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      parserContext<span class="token punctuation">.</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fatal</span><span class="token punctuation">(</span>  
            <span class="token string">&quot;Cannot locate BeanDefinitionParser for element [&quot;</span> <span class="token operator">+</span> localName <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">return</span> parser<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>ä»£ç æœç„¶å’Œä¸Šé¢åˆ†æçš„ä¸€æ ·ï¼Œæ ¹æ®å½“å‰æ ‡ç­¾å…ƒç´ çš„åç§°æ‰¾åˆ°å¯¹åº”çš„ bean å®šä¹‰ä¿¡æ¯è§£æå™¨ï¼Œå¦‚ <code>component-scan</code> æ ‡ç­¾å¯¹åº”çš„ bean å®šä¹‰ä¿¡æ¯è§£æå™¨ä¸º <code>ComponentScanBeanDefinitionParser</code>ï¼Œè°ƒç”¨è§£æå™¨ä¸­çš„ <code>parse()</code> è§£æå½“å‰æ ‡ç­¾å…ƒç´ ã€‚</p> <h6 id="_2-3-3-2-3-beandefinitionparser"><a href="#_2-3-3-2-3-beandefinitionparser" class="header-anchor">#</a> 2.3.3.2.3. BeanDefinitionParser</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">BeanDefinition</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token class-name">Element</span> element<span class="token punctuation">,</span> <span class="token class-name">ParserContext</span> parserContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> basePackage <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">BASE_PACKAGE_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    basePackage <span class="token operator">=</span> parserContext<span class="token punctuation">.</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolvePlaceholders</span><span class="token punctuation">(</span>basePackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> basePackages <span class="token operator">=</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">tokenizeToStringArray</span><span class="token punctuation">(</span>basePackage<span class="token punctuation">,</span> <span class="token class-name">ConfigurableApplicationContext</span><span class="token punctuation">.</span><span class="token constant">CONFIG_LOCATION_DELIMITERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Actually scan for bean definitions and register them.</span>
    <span class="token class-name">ClassPathBeanDefinitionScanner</span> scanner <span class="token operator">=</span> <span class="token function">configureScanner</span><span class="token punctuation">(</span>parserContext<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">&gt;</span></span> beanDefinitions <span class="token operator">=</span> scanner<span class="token punctuation">.</span><span class="token function">doScan</span><span class="token punctuation">(</span>basePackages<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">registerComponents</span><span class="token punctuation">(</span>parserContext<span class="token punctuation">.</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> beanDefinitions<span class="token punctuation">,</span> element<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¯ä»¥å‘ç°é¦–å…ˆå°±è·å–å½“å‰ <code>context:component-scan</code> æ ‡ç­¾ä¸­çš„ <code>base-package</code> å±æ€§çš„å€¼ï¼Œç„¶åä½¿ç”¨ <code>Environment</code> å¯¹è±¡ä¸­çš„ <code>resolvePlaceholders()</code> æ–¹æ³•æ›¿æ¢ <code>base-package</code> å­—ç¬¦ä¸²ä¸­å ä½ç¬¦ <code>${}</code> å†…çš„å€¼ã€‚å…³äº <code>Environment</code> å¯¹è±¡ï¼Œç¯å¢ƒå˜é‡ï¼Œæ”¶é›†æ‰€æœ‰çš„é…ç½®ä¿¡æ¯ã€‚<span style="background:#d3f8b6;">TODO</span> å…³äº <strong>ç¯å¢ƒå˜é‡</strong> åœ¨åç»­ä¹Ÿä¼šä¸“é—¨å†™ä¸€ç¯‡æ–‡ç« åˆ†æï¼Œæ­¤å¤„å°±ä¸å†åšè¯¦ç»†çš„æè¿°ã€‚å°† <code>base-package</code> å­—ç¬¦ä¸²æŒ‰ç…§é€—å·æ‹†å¼€æˆå­—ç¬¦ä¸²æ•°ç»„ï¼Œä¹Ÿå°±è¯´å’±ä»¬åœ¨ä½¿ç”¨ <code>context:component-scan</code> æ ‡ç­¾æ—¶ï¼Œå…¶ä¸­çš„ <code>base-package</code> å±æ€§å¯ä»¥å®šä¹‰å¤šä¸ªåŒ…æ‰«æè·¯å¾„ï¼Œä»¥é€—å·åˆ†éš”å³å¯ã€‚ç´§æ¥ç€ï¼Œè°ƒç”¨ <code>configureScanner()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª <code>ClassPathBeanDefinitionScanner</code> å®ä¾‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ <code>ClassPathBeanDefinitionScanner</code> å¯¹è±¡çš„ <code>doScan(basePackages)</code> æ–¹æ³•æ‰«æåŒ…è·¯å¾„ä¸‹æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç±»ï¼Œç„¶åå°†ç±»å°è£…æˆ bean å®šä¹‰ä¿¡æ¯ä¿å­˜åˆ° bean å®šä¹‰ä¿¡æ¯æ³¨å†Œä¸­å¿ƒã€‚<br>
åœ¨ <code>parse()</code> æ–¹æ³•çš„æœ€åè¿˜è°ƒç”¨ <strong><code>registerComponents()</code> æ–¹æ³•å¾€å®¹å™¨ä¸­æ³¨å†Œç»„ä»¶</strong>ï¼Œè®©å’±ä»¬ä¸€èµ·æ¥çœ‹ä¸‹æ³¨å†Œäº†å“ªäº›ç»„ä»¶ï¼Ÿ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">registerComponents</span><span class="token punctuation">(</span>  
      <span class="token class-name">XmlReaderContext</span> readerContext<span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">&gt;</span></span> beanDefinitions<span class="token punctuation">,</span> <span class="token class-name">Element</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  
   <span class="token class-name">Object</span> source <span class="token operator">=</span> readerContext<span class="token punctuation">.</span><span class="token function">extractSource</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token class-name">CompositeComponentDefinition</span> compositeDef <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CompositeComponentDefinition</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getTagName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionHolder</span> beanDefHolder <span class="token operator">:</span> beanDefinitions<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      compositeDef<span class="token punctuation">.</span><span class="token function">addNestedComponent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanComponentDefinition</span><span class="token punctuation">(</span>beanDefHolder<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
  
   <span class="token comment">// Register annotation config processors, if necessary.  </span>
   <span class="token keyword">boolean</span> annotationConfig <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">ANNOTATION_CONFIG_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      annotationConfig <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">ANNOTATION_CONFIG_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>annotationConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">&gt;</span></span> processorDefinitions <span class="token operator">=</span>  
            <span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token function">registerAnnotationConfigProcessors</span><span class="token punctuation">(</span>readerContext<span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinitionHolder</span> processorDefinition <span class="token operator">:</span> processorDefinitions<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
         compositeDef<span class="token punctuation">.</span><span class="token function">addNestedComponent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BeanComponentDefinition</span><span class="token punctuation">(</span>processorDefinition<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token punctuation">}</span>  
   <span class="token punctuation">}</span>  
  
   readerContext<span class="token punctuation">.</span><span class="token function">fireComponentRegistered</span><span class="token punctuation">(</span>compositeDef<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œæœ€ç»ˆä¼šè°ƒç”¨ <code>AnnotationConfigUtils</code> å·¥å…·ç±»ä¸­çš„ <code>registerAnnotationConfigProcessors()</code> æ–¹æ³• <strong>å¾€ Spring å®¹å™¨ä¸­æ³¨å†Œä¸€äº›ä¸æ³¨è§£æœ‰å…³çš„åç½®å¤„ç†å™¨çš„ bean å®šä¹‰ä¿¡æ¯</strong>ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰ <code>ConfigurationClassPostProcessor</code>ã€<code>AutowiredAnnotationBeanPostProcessor</code>ã€<code>CommonAnnotationBeanPostProcessor</code>ã€<code>EventListenerMethodProcessor</code> è¿™å‡ ä¸ªåç½®å¤„ç†å™¨å’Œä¸€ä¸ª <code>DefaultEventListenerFactory</code> é»˜è®¤çš„äº‹ä»¶ç›‘å¬å™¨å·¥å‚ç±»ã€‚</p> <ul><li><strong><code>ConfigurationClassPostProcessor</code> å°±æ˜¯åœ¨ä½¿ç”¨æ³¨è§£é©±åŠ¨å¼€å‘æ—¶ä¸“é—¨ç”¨æ¥æ‰«æç»„ä»¶çš„åç½®å¤„ç†å™¨</strong>ã€‚</li> <li><code>EventListenerMethodProcessor</code> åç½®å¤„ç†å™¨å’Œ <code>DefaultEventListenerFactory</code> äº‹ä»¶ç›‘å¬å™¨å·¥å‚ç±»ä¸ Spring äº‹ä»¶çš„è®¢é˜…å‘å¸ƒåŠŸèƒ½æœ‰å…³ï¼Œè¯¦æƒ…å¯ä»¥æŸ¥çœ‹ <a href="/blog/md/springå…¨å®¶æ¡¶/spring/Springäº‹ä»¶çš„è®¢é˜…å‘å¸ƒåŸç†åˆ†æ/">Springäº‹ä»¶çš„è®¢é˜…å‘å¸ƒåŸç†åˆ†æ</a> è¿™ä¸€ç¯‡æ–‡ç« ã€‚</li></ul> <p>å¯èƒ½æœ‰å¾ˆå¤šå°ä¼™ä¼´é˜…è¯»è¿‡ Spring æºç ä¹‹åï¼Œåœ¨æ‰§è¡Œåç½®å¤„ç†å™¨é˜¶æ®µæ—¶ï¼Œå§‹ç»ˆä¸æ˜ç™½ä¸ºä»€ä¹ˆå®¹å™¨ä¸­å·²ç»å­˜åœ¨ <code>ConfigurationClassPostProcessor</code> çš„åç½®å¤„ç†å™¨ï¼Œè¿™å°±æ˜¯åŸå› ã€‚<br> <span style="background:#d3f8b6;">TODO</span> å…³äºè¿™äº›åç½®å¤„ç†å™¨æ˜¯æ˜¯ä»€ä¹ˆä»¥åŠæœ‰ä»€ä¹ˆç”¨ï¼Ÿåœ¨åç»­çš„æºç åˆ†ææ–‡ç« ä¸­ä¼šè¯¦ç»†åœ°è¯´æ¸…æ¥šã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">&gt;</span></span> <span class="token function">registerAnnotationConfigProcessors</span><span class="token punctuation">(</span>
			<span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// å°†æ³¨å†Œä¸­å¿ƒ registry è½¬æ¢æˆ DefaultListableBeanFactory ç±»å‹çš„æ³¨å†Œä¸­å¿ƒ</span>
	<span class="token class-name">DefaultListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">unwrapDefaultListableBeanFactory</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>beanFactory <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getDependencyComparator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			beanFactory<span class="token punctuation">.</span><span class="token function">setDependencyComparator</span><span class="token punctuation">(</span><span class="token class-name">AnnotationAwareOrderComparator</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">.</span><span class="token function">getAutowireCandidateResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">ContextAnnotationAutowireCandidateResolver</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			beanFactory<span class="token punctuation">.</span><span class="token function">setAutowireCandidateResolver</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ContextAnnotationAutowireCandidateResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// å°è£… BeanDefinition çš„é›†åˆ</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">&gt;</span></span> beanDefs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// æ³¨å†Œåº•å±‚çš„å¤„ç†é…ç½®ç±»çš„åç½®å¤„ç†å™¨ ConfigurationClassPostProcessor çš„ BeanDefinition</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">RootBeanDefinition</span> def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">ConfigurationClassPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> <span class="token constant">CONFIGURATION_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// æ³¨å†Œåº•å±‚çš„è‡ªåŠ¨è£…é…åŠŸèƒ½çš„åç½®å¤„ç†å™¨ AutowiredAnnotationBeanPostProcessor çš„ BeanDefinition</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">RootBeanDefinition</span> def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">AutowiredAnnotationBeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> <span class="token constant">AUTOWIRED_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// æ³¨å†Œæ”¯æŒ JSR-250 è§„èŒƒçš„åç½®å¤„ç†å™¨ CommonAnnotationBeanPostProcessor çš„ BeanDefinition</span>
	<span class="token comment">// Check for JSR-250 support, and if present add the CommonAnnotationBeanPostProcessor.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>jsr250Present <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">COMMON_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">RootBeanDefinition</span> def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">CommonAnnotationBeanPostProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> <span class="token constant">COMMON_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// æ³¨å†Œæ”¯æŒ JPA åŠŸèƒ½çš„åç½®å¤„ç†å™¨ PersistenceAnnotationBeanPostProcessor çš„ BeanDefinition</span>
	<span class="token comment">// Check for JPA support, and if present add the PersistenceAnnotationBeanPostProcessor.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>jpaPresent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">RootBeanDefinition</span> def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			def<span class="token punctuation">.</span><span class="token function">setBeanClass</span><span class="token punctuation">(</span><span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token constant">PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME</span><span class="token punctuation">,</span>
					<span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span>
					<span class="token string">&quot;Cannot load optional framework class: &quot;</span> <span class="token operator">+</span> <span class="token constant">PERSISTENCE_ANNOTATION_PROCESSOR_CLASS_NAME</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> <span class="token constant">PERSISTENCE_ANNOTATION_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// æ³¨å†Œæ”¯æŒäº‹ä»¶æ–¹æ³•åŠŸèƒ½çš„åç½®å¤„ç†å™¨ EventListenerMethodProcessor çš„ BeanDefinition</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">EVENT_LISTENER_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">RootBeanDefinition</span> def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">EventListenerMethodProcessor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> <span class="token constant">EVENT_LISTENER_PROCESSOR_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// æ³¨å†Œæ”¯æŒäº‹ä»¶å·¥å‚åŠŸèƒ½çš„åç½®å¤„ç†å™¨ DefaultEventListenerFactory çš„ BeanDefinition</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registry<span class="token punctuation">.</span><span class="token function">containsBeanDefinition</span><span class="token punctuation">(</span><span class="token constant">EVENT_LISTENER_FACTORY_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">RootBeanDefinition</span> def <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RootBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">DefaultEventListenerFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		def<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
		beanDefs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">registerPostProcessor</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> def<span class="token punctuation">,</span> <span class="token constant">EVENT_LISTENER_FACTORY_BEAN_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> beanDefs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><h6 id="_2-3-3-2-4-classpathbeandefinitionscanner"><a href="#_2-3-3-2-4-classpathbeandefinitionscanner" class="header-anchor">#</a> 2.3.3.2.4. ClassPathBeanDefinitionScanner</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ClassPathBeanDefinitionScanner</span> <span class="token function">configureScanner</span><span class="token punctuation">(</span><span class="token class-name">ParserContext</span> parserContext<span class="token punctuation">,</span> <span class="token class-name">Element</span> element<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">boolean</span> useDefaultFilters <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">USE_DEFAULT_FILTERS_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        useDefaultFilters <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">parseBoolean</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">USE_DEFAULT_FILTERS_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Delegate bean definition registration to scanner class.</span>
    <span class="token class-name">ClassPathBeanDefinitionScanner</span> scanner <span class="token operator">=</span> <span class="token function">createScanner</span><span class="token punctuation">(</span>parserContext<span class="token punctuation">.</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> useDefaultFilters<span class="token punctuation">)</span><span class="token punctuation">;</span>
    scanner<span class="token punctuation">.</span><span class="token function">setBeanDefinitionDefaults</span><span class="token punctuation">(</span>parserContext<span class="token punctuation">.</span><span class="token function">getDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBeanDefinitionDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    scanner<span class="token punctuation">.</span><span class="token function">setAutowireCandidatePatterns</span><span class="token punctuation">(</span>parserContext<span class="token punctuation">.</span><span class="token function">getDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAutowireCandidatePatterns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">hasAttribute</span><span class="token punctuation">(</span><span class="token constant">RESOURCE_PATTERN_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        scanner<span class="token punctuation">.</span><span class="token function">setResourcePattern</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token constant">RESOURCE_PATTERN_ATTRIBUTE</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">parseBeanNameGenerator</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> scanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parserContext<span class="token punctuation">.</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parserContext<span class="token punctuation">.</span><span class="token function">extractSource</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">parseScope</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> scanner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parserContext<span class="token punctuation">.</span><span class="token function">getReaderContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> parserContext<span class="token punctuation">.</span><span class="token function">extractSource</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getCause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">parseTypeFilters</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> scanner<span class="token punctuation">,</span> parserContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> scanner<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆåˆ¤æ–­å’±ä»¬æ˜¯å¦é…ç½® <code>context:component-scan</code> æ ‡ç­¾ä¸­çš„ <code>use-default-filters</code> å±æ€§ï¼Œå¦‚æœé…ç½®çš„è¯ï¼Œåˆ™ä»¥å’±ä»¬é…ç½®çš„ä¸ºå‡†ï¼Œå¦‚æœæ²¡æœ‰é…ç½®çš„è¯ï¼Œåˆ™æŒ‰é»˜è®¤çš„æ¥ã€‚ç„¶åè°ƒç”¨ <code>createScanner()</code> åˆ›å»ºä¸€ä¸ª <code>ClassPathBeanDefinitionScanner</code> çš„å®ä¾‹å¯¹è±¡ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­æ— éæ˜¯ä½¿ç”¨æ„é€ æ–¹æ³•åˆ›å»ºä¸€ä¸ªå¯¹è±¡ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">ClassPathBeanDefinitionScanner</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">,</span> <span class="token keyword">boolean</span> useDefaultFilters<span class="token punctuation">,</span>  
      <span class="token class-name">Environment</span> environment<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ResourceLoader</span> resourceLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  
   <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token string">&quot;BeanDefinitionRegistry must not be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">this</span><span class="token punctuation">.</span>registry <span class="token operator">=</span> registry<span class="token punctuation">;</span>  
  
   <span class="token keyword">if</span> <span class="token punctuation">(</span>useDefaultFilters<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token function">registerDefaultFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token function">setEnvironment</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token function">setResourceLoader</span><span class="token punctuation">(</span>resourceLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>æ„é€ æ–¹æ³•ä¸­çš„æ¯ä¸ªå‚æ•°éƒ½æœ‰æ„ä¹‰ï¼Œ<code>registry</code> ä»£è¡¨ bean å®šä¹‰ä¿¡æ¯æ³¨å†Œä¸­å¿ƒï¼Œ<code>useDefaultFilters</code> ä»£è¡¨æ˜¯å¦ä½¿ç”¨é»˜è®¤çš„è¿‡æ»¤ç­–ç•¥ï¼Œ<code>environment</code> ä»£è¡¨ç€å°è£…çš„é…ç½®ä¿¡æ¯ï¼Œ<code>resourceLoader</code> ä»£è¡¨èµ„æºåŠ è½½å™¨ï¼Œç”¨äºåŠ è½½æŸè·¯å¾„ä¸‹çš„æ–‡ä»¶å°†å…¶è½¬åŒ–æˆ <code>Resoure</code> æ¥å£å¯¹è±¡ã€‚å½“ä½¿ç”¨é»˜è®¤çš„è¿‡æ»¤ç­–ç•¥æ—¶ï¼Œåˆ™ä¼šæ³¨å†Œä¸€äº›é»˜è®¤çš„è¿‡æ»¤ç­–ç•¥ï¼ŒåŒ…å« @Componentã€@Inject æ³¨è§£ï¼Œç”±äº@Repositoryã€@Serviceã€@Controller æ³¨è§£å…·æœ‰ @Component æ³¨è§£ï¼Œæ‰€ä»¥æ ‡æ³¨è¿™äº›æ³¨è§£çš„ç±»ä¹Ÿä¼šè¢«ä¿ç•™ä¸‹æ¥ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">registerDefaultFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">this</span><span class="token punctuation">.</span>includeFilters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnnotationTypeFilter</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token class-name">ClassLoader</span> cl <span class="token operator">=</span> <span class="token class-name">ClassPathScanningCandidateComponentProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token keyword">try</span> <span class="token punctuation">{</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span>includeFilters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnnotationTypeFilter</span><span class="token punctuation">(</span>  
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;javax.annotation.ManagedBean&quot;</span><span class="token punctuation">,</span> cl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;JSR-250 'javax.annotation.ManagedBean' found and supported for component scanning&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token comment">// JSR-250 1.1 API (as included in Java EE 6) not available - simply skip.  </span>
   <span class="token punctuation">}</span>  
   <span class="token keyword">try</span> <span class="token punctuation">{</span>  
      <span class="token keyword">this</span><span class="token punctuation">.</span>includeFilters<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnnotationTypeFilter</span><span class="token punctuation">(</span>  
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Annotation</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;javax.inject.Named&quot;</span><span class="token punctuation">,</span> cl<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;JSR-330 'javax.inject.Named' annotation found and supported for component scanning&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token comment">// JSR-330 API not available - simply skip.  </span>
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>è¯¥æ–¹æ³•è¯´ç™½äº†å°±æ˜¯ç»™ç±»ä¸­çš„ <code>includeFilters</code> é›†åˆå±æ€§å¢åŠ å…ƒç´ ï¼Œå¦‚ <code>AnnotationTypeFilter(Component.class)</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†åˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç»“åˆå’±ä»¬ä½¿ç”¨ Spring æ—¶çš„ç»éªŒï¼Œå¤§èƒ†çŒœæµ‹ä¸€ä¸‹ï¼Œåªæœ‰è¢« <code>@Component</code> æ³¨è§£æ ‡æ³¨çš„ç±»æ‰ä¼šå†æ‰«æåˆ°ä¹‹åä¿ç•™ä¸‹æ¥ã€‚åˆ°åº•æ˜¯ä¸æ˜¯è¿™æ ·å‘¢ï¼Ÿå’±ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚<br> <code>ClassPathBeanDefinitionScanner</code> å¯¹è±¡åˆ›å»ºå‡ºæ¥åï¼Œè‚¯å®šå°±è¦ä½¿ç”¨ï¼Œè°ƒç”¨ <code>doScan()</code> æ–¹æ³•ï¼ŒæŠŠè¦æ‰«æçš„åŒ…è·¯å¾„æ•°ç»„ä¼ è¿›å»ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">&gt;</span></span> <span class="token function">doScan</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> basePackages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>basePackages<span class="token punctuation">,</span> <span class="token string">&quot;At least one base package must be specified&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">&gt;</span></span> beanDefinitions <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// éå†basePackagesè·¯å¾„</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> basePackage <span class="token operator">:</span> basePackages<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ‰«ææ‰€æœ‰ç»„ä»¶ï¼Œæ‰¾åˆ°å€™é€‰ç»„ä»¶ï¼Œéœ€è¦æ‰«æè¿›æ¥çš„ç»„ä»¶çš„ BeanDefinition é›†åˆ</span>
        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> candidates <span class="token operator">=</span> <span class="token function">findCandidateComponents</span><span class="token punctuation">(</span>basePackage<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">BeanDefinition</span> candidate <span class="token operator">:</span> candidates<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å– BeanDefinition ä¸­ï¼Œ@Scope æ³¨è§£çš„å…ƒæ•°æ®</span>
            <span class="token class-name">ScopeMetadata</span> scopeMetadata <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scopeMetadataResolver<span class="token punctuation">.</span><span class="token function">resolveScopeMetadata</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æ³¨è§£ @Scope é»˜è®¤çš„ä½œç”¨åŸŸæ˜¯å•ä¾‹ï¼šSINGLETON</span>
            candidate<span class="token punctuation">.</span><span class="token function">setScope</span><span class="token punctuation">(</span>scopeMetadata<span class="token punctuation">.</span><span class="token function">getScopeName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç”Ÿæˆ bean çš„åç§°</span>
            <span class="token class-name">String</span> beanName <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanNameGenerator<span class="token punctuation">.</span><span class="token function">generateBeanName</span><span class="token punctuation">(</span>candidate<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// åˆ¤æ–­ BeanDefinition æ˜¯å¦æ˜¯ AbstractBeanDefinition ç±»å‹çš„å®ä¾‹</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>candidate <span class="token keyword">instanceof</span> <span class="token class-name">AbstractBeanDefinition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ä¸ºå½“å‰ BeanDefinition æ³¨å†Œä¸€äº›é»˜è®¤çš„å±æ€§å€¼</span>
                <span class="token function">postProcessBeanDefinition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AbstractBeanDefinition</span><span class="token punctuation">)</span> candidate<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// åˆ¤æ–­ BeanDefinition æ˜¯å¦æ˜¯ AnnotatedBeanDefinition ç±»å‹çš„å®ä¾‹ï¼Œå³æ˜¯å¦æ˜¯æ³¨è§£ç±»å‹çš„ BeanDefinition</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>candidate <span class="token keyword">instanceof</span> <span class="token class-name">AnnotatedBeanDefinition</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">/**
				 * å°†å…¶å®ƒå„æ³¨è§£ä¸Šçš„ä¿¡æ¯è®¾ç½®åˆ° BeanDefinition ä¸­ï¼ˆ@Lazy/@Primary/@DependsOn/@Role/@Descriptionï¼‰
				 * å³å†è®¾ç½®ä¸€æ¬¡å€¼
				 */</span>
                <span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token function">processCommonDefinitionAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AnnotatedBeanDefinition</span><span class="token punctuation">)</span> candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// åˆ¤æ–­å½“å‰ candidate ä¸å®¹å™¨ä¸­å·²ç»æ³¨å†Œçš„ BeanDefinition æ˜¯å¦å…¼å®¹</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkCandidate</span><span class="token punctuation">(</span>beanName<span class="token punctuation">,</span> candidate<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å°è£…æˆ BeanDefinitionHolder</span>
                <span class="token class-name">BeanDefinitionHolder</span> definitionHolder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionHolder</span><span class="token punctuation">(</span>candidate<span class="token punctuation">,</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                definitionHolder <span class="token operator">=</span>
                    <span class="token class-name">AnnotationConfigUtils</span><span class="token punctuation">.</span><span class="token function">applyScopedProxyMode</span><span class="token punctuation">(</span>scopeMetadata<span class="token punctuation">,</span> definitionHolder<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
                beanDefinitions<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>definitionHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å°† BeanDefinition æ³¨å†Œåˆ°å®¹å™¨ä¸­</span>
                <span class="token function">registerBeanDefinition</span><span class="token punctuation">(</span>definitionHolder<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> beanDefinitions<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p>åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œå¾ªç¯éå†ä¼ å…¥è¿›æ¥çš„åŒ…æ‰«æè·¯å¾„æ•°ç»„ï¼Œæ‰¾åˆ°å€™é€‰çš„ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯å°†ç¬¦åˆæ¡ä»¶çš„ç±»å°è£…æˆ bean å®šä¹‰ä¿¡æ¯ï¼Œæ‰¾åˆ°ä¹‹åï¼Œå¼€å§‹ç»™æ‰¾åˆ°çš„æ¯ä¸€ä¸ª bean å®šä¹‰ä¿¡æ¯å¡«å……å±æ€§ï¼Œå¦‚ (lazyï¼Œprimary...)ï¼Œæœ€åï¼Œå°†å…¶ä¿å­˜åˆ° bean å®šä¹‰ä¿¡æ¯æ³¨å†Œä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯å’±ä»¬çš„ <code>DefaultListableBeanFactory</code> å®ä¾‹å¯¹è±¡ä¸­çš„ <code>beanDefinitionMap</code> é›†åˆä¸­ã€‚Spring æ˜¯æ€æ ·æ‰«æåŒ…è·¯å¾„ä¸‹çš„ç±»å¹¶å°†å…¶è½¬åŒ–æˆ bean å®šä¹‰ä¿¡æ¯çš„å‘¢ï¼Ÿææ‡‚è¿™ä¸ªé—®é¢˜ï¼Œå°±å·®ä¸å¤šç»“æŸäº†ã€‚</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">findCandidateComponents</span><span class="token punctuation">(</span><span class="token class-name">String</span> basePackage<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token comment">/**  
    * Spring è™½ç„¶æ”¯æŒ Component ç´¢å¼•æŠ€æœ¯ï¼Œä½†éœ€è¦å¼•å…¥ä¸€ä¸ªç»„ä»¶ï¼Œå› æ­¤å¤§éƒ¨åˆ†æƒ…å†µä¸ä¼šå¼•å…¥è¿™ä¸ªç»„ä»¶ï¼Œæ‰€ä»¥ä¸ä¼šè¿›å…¥åˆ°è¿™ä¸ª if æ¡ä»¶  
    */</span>  
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>componentsIndex <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token function">indexSupportsIncludeFilters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      <span class="token keyword">return</span> <span class="token function">addCandidateComponentsFromIndex</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>componentsIndex<span class="token punctuation">,</span> basePackage<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
   <span class="token keyword">else</span> <span class="token punctuation">{</span>  
      <span class="token comment">// æ‰«ææ‰€æœ‰ç»„ä»¶  </span>
      <span class="token keyword">return</span> <span class="token function">scanCandidateComponents</span><span class="token punctuation">(</span>basePackage<span class="token punctuation">)</span><span class="token punctuation">;</span>  
   <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> <span class="token function">scanCandidateComponents</span><span class="token punctuation">(</span><span class="token class-name">String</span> basePackage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">BeanDefinition</span><span class="token punctuation">&gt;</span></span> candidates <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>

		<span class="token comment">// æŠŠä¼ è¿›æ¥çš„ç±»ä¼¼å‘½åç©ºé—´å½¢å¼çš„å­—ç¬¦ä¸²è½¬æ¢æˆç±»ä¼¼æ–‡ä»¶åœ°å€çš„å½¢å¼ï¼Œç„¶åå†å‰é¢åŠ ä¸Š &quot;classpath*:&quot;</span>
		<span class="token comment">// å³ com.xx  ==&gt;  classpath*:com/xx/**/*.class</span>
		<span class="token class-name">String</span> packageSearchPath <span class="token operator">=</span> <span class="token class-name">ResourcePatternResolver</span><span class="token punctuation">.</span><span class="token constant">CLASSPATH_ALL_URL_PREFIX</span> <span class="token operator">+</span>
				<span class="token function">resolveBasePackage</span><span class="token punctuation">(</span>basePackage<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token char">'/'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePattern<span class="token punctuation">;</span>
		<span class="token comment">// åŠ è½½ packageSearchPath è·¯å¾„ä¸‹çš„æ‰€æœ‰èµ„æº</span>
		<span class="token class-name">Resource</span><span class="token punctuation">[</span><span class="token punctuation">]</span> resources <span class="token operator">=</span> <span class="token function">getResourcePatternResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>packageSearchPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> traceEnabled <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">isTraceEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> debugEnabled <span class="token operator">=</span> logger<span class="token punctuation">.</span><span class="token function">isDebugEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// éå†å¤„ç†æ¯ä¸ªèµ„æº Resource</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Resource</span> resource <span class="token operator">:</span> resources<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>traceEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Scanning &quot;</span> <span class="token operator">+</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// åˆ¤æ–­èµ„æºæ˜¯å¦å¯è¯»ï¼Œå¹¶ä¸”ä¸æ˜¯ä¸€ä¸ªç›®å½•</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">isReadable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">try</span> <span class="token punctuation">{</span>
					<span class="token comment">/**
					 * ç”Ÿæˆæ¯ä¸ªèµ„æºçš„å…ƒæ•°æ®ä¿¡æ¯
					 * metadataReaderï¼šå…ƒæ•°æ®è¯»å–å™¨ï¼Œè§£æ resourceï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºæè¿°èµ„æºçš„æ•°æ®ç»“æ„
					 */</span>
					<span class="token class-name">MetadataReader</span> metadataReader <span class="token operator">=</span> <span class="token function">getMetadataReaderFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMetadataReader</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// åˆ¤æ–­å½“å‰èµ„æºæ˜¯å¦ç¬¦åˆå€™é€‰æ¡ä»¶</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCandidateComponent</span><span class="token punctuation">(</span>metadataReader<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// å°è£…æˆ ScannedGenericBeanDefinition ç±»å‹</span>
						<span class="token class-name">ScannedGenericBeanDefinition</span> sbd <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScannedGenericBeanDefinition</span><span class="token punctuation">(</span>metadataReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
						sbd<span class="token punctuation">.</span><span class="token function">setSource</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token comment">// åˆ¤æ–­ ScannedGenericBeanDefinition æ˜¯å¦ç¬¦åˆæ¡ä»¶ï¼Œå³çœŸæ­£æ‰§è¡ŒåŒ¹é…è§„åˆ™ï¼Œæ³¨å†Œé…ç½®ç±»è‡ªèº«ä¼šè¢«æ’é™¤ï¼Œä¸ä¼šè¿›å…¥</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isCandidateComponent</span><span class="token punctuation">(</span>sbd<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>debugEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Identified candidate component class: &quot;</span> <span class="token operator">+</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							candidates<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sbd<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span> <span class="token punctuation">{</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>debugEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								logger<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Ignored because not a concrete top-level class: &quot;</span> <span class="token operator">+</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>traceEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Ignored because not matching any filter: &quot;</span> <span class="token operator">+</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span>
							<span class="token string">&quot;Failed to read candidate component class: &quot;</span> <span class="token operator">+</span> resource<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>traceEnabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Ignored because not readable: &quot;</span> <span class="token operator">+</span> resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BeanDefinitionStoreException</span><span class="token punctuation">(</span><span class="token string">&quot;I/O failure during classpath scanning&quot;</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> candidates<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br></div></div><p>å…¶å®å°±æ˜¯ <strong>é€’å½’éå†æ‰¾åˆ°åŒ…è·¯å¾„åŠå…¶å­åŒ…ä¸‹æ‰€æœ‰çš„.class æ–‡ä»¶</strong>ï¼Œæ‰“ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ‰¾åˆ°äº†å“ªäº›ç±»ã€‚<br> <img alt="" data-src="https://fastly.jsdelivr.net/gh/xihuanxiaorang/images/Pasted%20image%2020220925174257.png" loading="lazy" class="lazy"><br>
ä»¥æœ¬æµ‹è¯•æ¡ˆä¾‹æ¥è¯´ï¼Œåœ¨åŒ…æ‰«æè·¯å¾„ä¸‹çš„ç±»å­˜åœ¨ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ <code>People</code>ã€<code>UserService</code> å’Œ <code>SpringBeanDefinitionTests</code>ã€‚è‚¯å®šä¸å¯èƒ½ä¸‰ä¸ªç±»éƒ½éœ€è¦ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¿‡æ»¤æ‰ä¸éœ€è¦çš„ç±»ï¼Œä¿ç•™æ»¡è¶³æ¡ä»¶çš„ç±»ï¼Œæ­¤æ—¶è¿‡æ»¤ç­–ç•¥æ˜¯ä¸æ˜¯å°±è¯¥èµ·ä½œç”¨äº†ï¼Ÿ</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * ç¡®å®šç»™å®šçš„ç±»æ˜¯å¦ä¸åŒ¹é…ä»»ä½•æ’é™¤è¿‡æ»¤å™¨å¹¶ä¸”åŒ¹é…è‡³å°‘ä¸€ä¸ªåŒ…å«è¿‡æ»¤å™¨
 * @return è¯¥ç±»æ˜¯å¦æœ‰èµ„æ ¼ä½œä¸ºå€™é€‰ç»„ä»¶
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">isCandidateComponent</span><span class="token punctuation">(</span><span class="token class-name">MetadataReader</span> metadataReader<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TypeFilter</span> tf <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>excludeFilters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tf<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>metadataReader<span class="token punctuation">,</span> <span class="token function">getMetadataReaderFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">TypeFilter</span> tf <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>includeFilters<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tf<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>metadataReader<span class="token punctuation">,</span> <span class="token function">getMetadataReaderFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">isConditionMatch</span><span class="token punctuation">(</span>metadataReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>åœ¨å‰é¢çš„åˆ†æä¸­ï¼Œ<code>includeFilters</code> é›†åˆä¸­å·²ç»å­˜æ”¾äº†ä¸€ä¸ª <code>@Component</code> æ³¨è§£çš„è¿‡æ»¤ç­–ç•¥ï¼Œæ‰€ä»¥æ‰è¯´æ ‡æ³¨äº† <code>@Component</code> æ³¨è§£çš„ç±»æ‰ä¼šè¢«æ‰«æåˆ° Spring å®¹å™¨ä¸­ã€‚ç°åœ¨æƒ³ä¸€ä¸‹ï¼Œå’±ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åŸºäºè¿™ä¸€ç‚¹ï¼Œæ¨¡ä»¿ç€è‡ªå®šä¹‰ä¸€ä¸ªè¿‡æ»¤ç­–ç•¥ï¼Œç„¶åå°†å’±ä»¬æƒ³è¦æ³¨å†Œåˆ° Spring å®¹å™¨ä¸­çš„ç»„ä»¶æ‰«æè¿›æ¥ï¼Œ<span style="background:#d3f8b6;">TODO</span> è‡³äºè¿™ä¸ª Spring çš„æ‰©å±•ç‚¹ï¼Œåç»­ä¼šåœ¨ä¸“é—¨çš„ <a href="/blog/md/springå…¨å®¶æ¡¶/æ‰©å±•/Springæ‰©å±•.html">Springæ‰©å±•</a> è¿™ä¸€ç¯‡æ–‡ç« ä¸­æåˆ°ã€‚</p> <blockquote><p>æºç é˜…è¯»æŠ€å·§ï¼šå­¦å®ŒæŸä¸€å—æºç ï¼Œè¦å­¦ä¼šæ€è€ƒï¼Œå’±ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åŸºäºå’±ä»¬çš„å­¦åˆ°çš„åšä¸€äº›æ‰©å±•ï¼Œæ¨¡ä»¿ï¼Œä¸è¦åªä¼šæ­»è®°ç¡¬èƒŒï¼</p></blockquote> <p>è‡³æ­¤ï¼Œå…³äº XML ç‰ˆçš„ <code>BeanDefinition</code> çš„æ•´ä¸ªåŠ è½½æµç¨‹çš„åˆ†ææµç¨‹å°±å·²ç»åœ†æ»¡ç»“æŸäº†ï¼Œä¸€èµ·è·Ÿä¸‹æ¥çš„å°ä¼™ä¼´æƒ³å¿…ä¹Ÿæœ‰æ‰€æ”¶è·ï¼Œè®©å’±ä»¬ä¸€èµ·åŠ æ²¹ã€‚ğŸ¥³ğŸ¥³ğŸ¥³</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xihuanxiaorang/CodeGuide/edit/main/docs/md/springå…¨å®¶æ¡¶/spring/æºç /Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°: </span> <span class="time">2022/11/12</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Springæ³¨å†ŒBeançš„å‡ ç§æ–¹å¼.html" class="prev">
          Springæ³¨å†ŒBeançš„å‡ ç§æ–¹å¼
        </a></span> <span class="next"><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Spring-ConfigurationClassPostProcessoråç½®å¤„ç†å™¨è¯¦è§£.html">
          Spring-ConfigurationClassPostProcessoråç½®å¤„ç†å™¨è¯¦è§£
        </a>
        â†’
      </span></p></div> </main></div> <aside class="page-sidebar"> <div class="page-side-toolbar"><div class="option-box-toc-fixed"><div class="toc-container-sidebar"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:650px"><div style="font-weight:bold;text-align:center;">Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-ç¯å¢ƒæ­å»º" class="toc-sidebar-link">1. ç¯å¢ƒæ­å»º</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-1-åˆ›å»º-spring-beandefinition-study-æ¨¡å—" class="toc-sidebar-link">1.1. åˆ›å»º spring-beandefinition-study æ¨¡å—</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-2-å¼•å…¥ç›¸å…³ä¾èµ–" class="toc-sidebar-link">1.2. å¼•å…¥ç›¸å…³ä¾èµ–</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-3-æ—¥å¿—é…ç½®æ–‡ä»¶" class="toc-sidebar-link">1.3. æ—¥å¿—é…ç½®æ–‡ä»¶</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-4-ç›®æ ‡ç±»" class="toc-sidebar-link">1.4. ç›®æ ‡ç±»</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-5-spring-æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="toc-sidebar-link">1.5. Spring æ ¸å¿ƒé…ç½®æ–‡ä»¶</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-6-æµ‹è¯•ç±»" class="toc-sidebar-link">1.6. æµ‹è¯•ç±»</a></li></ul></li><li><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-æºç åˆ†æ" class="toc-sidebar-link">2. æºç åˆ†æ</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-1-æºç åˆ†æå…¥å£" class="toc-sidebar-link">2.1. æºç åˆ†æå…¥å£</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-2-åˆ›å»º-beanfactory-å®ä¾‹" class="toc-sidebar-link">2.2. åˆ›å»º BeanFactory å®ä¾‹</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-3-è§£æ-xml-é…ç½®æ–‡ä»¶å¹¶åŠ è½½-bean-å®šä¹‰ä¿¡æ¯" class="toc-sidebar-link">2.3. è§£æ XML é…ç½®æ–‡ä»¶å¹¶åŠ è½½ bean å®šä¹‰ä¿¡æ¯</a></li></ul></li></ul></div></div></div></div></div> <div class="option-box-toc-over"><img src="/images/system/toc.png" class="nozoom"> <span class="show-txt">ç›®å½•</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="max-height:550px"><div style="font-weight:bold;text-align:center;">Spring-BeanDefinitionåŠ è½½æµç¨‹åˆ†æ</div> <hr> <div class="toc-box"><ul class="toc-sidebar-links"><li><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-ç¯å¢ƒæ­å»º" class="toc-sidebar-link">1. ç¯å¢ƒæ­å»º</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-1-åˆ›å»º-spring-beandefinition-study-æ¨¡å—" class="toc-sidebar-link">1.1. åˆ›å»º spring-beandefinition-study æ¨¡å—</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-2-å¼•å…¥ç›¸å…³ä¾èµ–" class="toc-sidebar-link">1.2. å¼•å…¥ç›¸å…³ä¾èµ–</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-3-æ—¥å¿—é…ç½®æ–‡ä»¶" class="toc-sidebar-link">1.3. æ—¥å¿—é…ç½®æ–‡ä»¶</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-4-ç›®æ ‡ç±»" class="toc-sidebar-link">1.4. ç›®æ ‡ç±»</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-5-spring-æ ¸å¿ƒé…ç½®æ–‡ä»¶" class="toc-sidebar-link">1.5. Spring æ ¸å¿ƒé…ç½®æ–‡ä»¶</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_1-6-æµ‹è¯•ç±»" class="toc-sidebar-link">1.6. æµ‹è¯•ç±»</a></li></ul></li><li><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-æºç åˆ†æ" class="toc-sidebar-link">2. æºç åˆ†æ</a><ul class="toc-sidebar-sub-headers"><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-1-æºç åˆ†æå…¥å£" class="toc-sidebar-link">2.1. æºç åˆ†æå…¥å£</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-2-åˆ›å»º-beanfactory-å®ä¾‹" class="toc-sidebar-link">2.2. åˆ›å»º BeanFactory å®ä¾‹</a></li><li class="toc-sidebar-sub-header"><a href="/blog/md/spring%E5%85%A8%E5%AE%B6%E6%A1%B6/spring/%E6%BA%90%E7%A0%81/Spring-BeanDefinition%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90.html#_2-3-è§£æ-xml-é…ç½®æ–‡ä»¶å¹¶åŠ è½½-bean-å®šä¹‰ä¿¡æ¯" class="toc-sidebar-link">2.3. è§£æ XML é…ç½®æ–‡ä»¶å¹¶åŠ è½½ bean å®šä¹‰ä¿¡æ¯</a></li></ul></li></ul></div></div></div></div></div> <div class="option-box"><img src="/images/system/toggle.png" width="30px" class="nozoom"> <span class="show-txt">å·¦æ </span></div> <div class="option-box"><img src="/images/system/heart-1.png" width="25px" class="nozoom"> <span class="show-txt">èµèµæˆ‘</span> <div class="toc-container"><div class="pos-box"><div class="icon-arrow"></div> <div class="scroll-box" style="text-align:center"><span style="font-size:0.8rem;font-weight:bold;">é¼“åŠ±/æ”¯æŒ/èµèµæˆ‘</span> <img height="180px" src="/images/personal/encourage-head.png" style="margin:5px;"> <br>1. ä¸é å®ƒç”Ÿå­˜ä½†ä»å¸Œæœ›å¾—åˆ°ä½ çš„é¼“åŠ±ï¼›
                <br>2. æ—¶åˆ»è­¦é†’è‡ªå·±ä¿æŒæŠ€æœ¯äººçš„åˆå¿ƒï¼Œæ²‰æ·€ï¼Œåˆ†äº«ï¼Œæˆé•¿ï¼›
              </div></div></div></div> <div title="Springæ³¨å†ŒBeançš„å‡ ç§æ–¹å¼" class="option-box" style="padding-left:2px;text-align:center;"><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Springæ³¨å†ŒBeançš„å‡ ç§æ–¹å¼.html"><img src="/images/system/pre2.png" width="30px" class="nozoom"> <span class="show-txt">ä¸Šä¸€ç¯‡</span></a></div> <div title="Spring-ConfigurationClassPostProcessoråç½®å¤„ç†å™¨è¯¦è§£" class="option-box" style="padding-left:2px;text-align:center;"><a href="/blog/md/springå…¨å®¶æ¡¶/spring/æºç /Spring-ConfigurationClassPostProcessoråç½®å¤„ç†å™¨è¯¦è§£.html"><img src="/images/system/next2.png" width="30px" class="nozoom"> <span class="show-txt">ä¸‹ä¸€ç¯‡</span></a></div></div>  <div class="page-side-sitemap"><div class="option-box"><img src="/images/system/sitemap.png" class="nozoom img"> <span class="show-txt">ç«™ç‚¹å›¾</span> <div class="sitemap-container"><h4>ç«™ç‚¹å¯¼èˆªå›¾
              <a href="/blog/md/about/me/2020-08-25-13å¹´æ¯•ä¸šï¼Œç”¨ä¸¤å¹´æ—¶é—´ä»å¤–åŒ…èµ°è¿›äº’è”ç½‘å¤§å‚.html" class="sitemap-top-link"> å…³äºæˆ‘</a> <a href="/blog/md/about/study/2020-04-30-è®²é“ç†ï¼Œåªè¦ä½ æ˜¯ä¸€ä¸ªçˆ±æŠ˜è…¾çš„ç¨‹åºå‘˜ï¼Œæ¯•ä¸šæ‰¾å·¥ä½œçœŸçš„ä¸éœ€è¦å†èŠ±é’±åŸ¹è®­.html" class="sitemap-top-link"> å…³äºå­¦ä¹ </a> <a href="/blog/md/about/job/2020-11-15-BATJTMDï¼Œå¤§å‚æ‹›è˜ï¼Œéƒ½æ‹›ä»€ä¹ˆæ ·Javaç¨‹åºå‘˜ï¼Ÿ.html" class="sitemap-top-link"> å…³äºèŒåœº</a></h4> <table class="sitemap-table"><tr><td nowrap="nowrap"><div class="sitemap-col-group">å¸¸ç”¨æœç´¢</div></td> <td><div class="sitemap-col-item"><a href="http://www.baidu.com/" target="_blank" title="ç™¾åº¦">  
          ç™¾åº¦
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.google.com/" target="_blank" title="Google">  
          Google
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.bing.com/" target="_blank" title="Bing">  
          Bing
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://github.com" target="_blank" title="Github">  
          Github
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.programcreek.com/java-api-examples/index.php" target="_blank" title="æœä»£ç ">  
          æœä»£ç 
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">æŠ€æœ¯ç¤¾åŒº</div></td> <td><div class="sitemap-col-item"><a href="http://www.csdn.net/" target="_blank" title="CDSN">  
          CDSN
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="http://www.cnblogs.com/" target="_blank" title="åšå®¢å›­">  
          åšå®¢å›­
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.oschina.net" target="_blank" title="OSChina">  
          OSChina
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://segmentfault.com/" target="_blank" title="æ€å¦">  
          æ€å¦
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://juejin.im" target="_blank" title="æ˜é‡‘">  
          æ˜é‡‘
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.linuxidc.com/" target="_blank" title="Linuxå…¬ç¤¾">  
          Linuxå…¬ç¤¾
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://www.ibm.com/developerworks/cn/" target="_blank" title="IBM å¼€å‘è€…">  
          IBM å¼€å‘è€…
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="sitemap-col-item"><a href="https://stackoverflow.com" target="_blank" title="StackOverflow">  
          StackOverflow
          <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></td> <!----></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">Spring</div></td> <!----> <td><a href="/blog/md/spring/source-code/index.html" class="sitemap-col-item">
          Spring æºç åˆ†æ
        </a></td></tr><tr><td nowrap="nowrap"><div class="sitemap-col-group">é¢å‘å¯¹è±¡</div></td> <!----> <td><a href="/blog/md/develop/design-pattern/index.html" class="sitemap-col-item">
          è®¾è®¡æ¨¡å¼
        </a></td></tr></table></div></div></div> <!----> </aside></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/cg-styles.js?v=1668302853734" defer></script><script src="/blog/assets/js/cg-3.js?v=1668302853734" defer></script><script src="/blog/assets/js/cg-4.js?v=1668302853734" defer></script><script src="/blog/assets/js/cg-24.js?v=1668302853734" defer></script><script src="/blog/assets/js/cg-app.js?v=1668302853734" defer></script>
  </body>
</html>
